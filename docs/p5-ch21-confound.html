<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>21&nbsp; Confounders in Model Training – Genomic Foundation Models</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./p5-ch22-interp.html" rel="next">
<link href="./p5-ch20-vep.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-b758ccaa5987ceb1b75504551e579abf.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-a1553387a0f784068632030e9fbb8a3c.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark-d1e9b63c6b6094879b9f94a7628e3370.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="site_libs/bootstrap/bootstrap-a1553387a0f784068632030e9fbb8a3c.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar floating quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./p5--eval-interp.html">Part V: Evaluation and Reliability</a></li><li class="breadcrumb-item"><a href="./p5-ch21-confound.html"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Confounders in Model Training</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Genomic Foundation Models</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./p1--foundations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Part I: Foundations</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p1-ch01-ngs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Sequencing: From Reads to Variants</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p1-ch02-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">The Genomic Data Landscape</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p1-ch03-pgs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">GWAS &amp; Polygenic Scores</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p1-ch04-cadd.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Deleteriousness Scores</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./p2--principles.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Part III: Core Principles</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p2-ch05-tokens.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Sequence Representation &amp; Tokens</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p2-ch06-transformers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Transformer Architecture for Genomics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p2-ch07-foundation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Genomic Foundation Models: Concepts &amp; Taxonomy</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p2-ch08-pretrain.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Pretraining Objectives &amp; Strategies</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p2-ch09-transfer.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Transfer Learning &amp; Deployment</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./p3--architectures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Part II: Deep Learning Architectures</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p3-ch10-cnn.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">CNN Sequence-to-Function Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p3-ch11-dna.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">DNA and Genomic Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p3-ch12-rna.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">RNA &amp; Transcript-Level Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p3-ch13-plm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Protein Language Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p3-ch14-hybrid.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Long-range Hybrid Models</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">p4–multi-modal_multi-scale.qmd</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p4-ch15-sc-epi.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Single-Cell &amp; Epigenomic Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p4-ch16-networks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Graphs, Networks, and Biology</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p4-ch17-systems.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Multi-Omics &amp; Systems Biology</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./p5--eval-interp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Part V: Evaluation and Reliability</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p5-ch18-benchmarks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Benchmarks for Genomic Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p5-ch19-eval.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Evaluation of Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p5-ch20-vep.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Variant Effect Prediction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p5-ch21-confound.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Confounders in Model Training</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p5-ch22-interp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Interpretability &amp; Mechanisms</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./p6--translation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Part VI — Translation and Application</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p6-ch23-clinical.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Clinical Risk Prediction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p6-ch24-variants.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Pathogenic Variant Discovery</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p6-ch25-drugs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Drug Discovery &amp; Biotech</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p6-ch26-design.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Sequence Design</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p6-ch27-future.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Future Work &amp; Ethics</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app-a-dl.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Deep Learning Primer</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app-b-deployment.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Model Deployment</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app-c-model-list.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Referenced Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app-d-resources.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">Additional Resources</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app-e-glossary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">E</span>&nbsp; <span class="chapter-title">Glossary</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#definitions-confounding-bias-and-leakage" id="toc-definitions-confounding-bias-and-leakage" class="nav-link active" data-scroll-target="#definitions-confounding-bias-and-leakage"><span class="header-section-number">21.1</span> Definitions: Confounding, Bias, and Leakage</a></li>
  <li><a href="#a-taxonomy-of-confounders-in-genomic-data" id="toc-a-taxonomy-of-confounders-in-genomic-data" class="nav-link" data-scroll-target="#a-taxonomy-of-confounders-in-genomic-data"><span class="header-section-number">21.2</span> A Taxonomy of Confounders in Genomic Data</a></li>
  <li><a href="#population-structure-and-ancestry-as-shortcuts" id="toc-population-structure-and-ancestry-as-shortcuts" class="nav-link" data-scroll-target="#population-structure-and-ancestry-as-shortcuts"><span class="header-section-number">21.3</span> Population Structure and Ancestry as Shortcuts</a>
  <ul class="collapse">
  <li><a href="#how-ancestry-becomes-a-confounder" id="toc-how-ancestry-becomes-a-confounder" class="nav-link" data-scroll-target="#how-ancestry-becomes-a-confounder"><span class="header-section-number">21.3.1</span> How Ancestry Becomes a Confounder</a></li>
  <li><a href="#ancestry-and-foundation-models" id="toc-ancestry-and-foundation-models" class="nav-link" data-scroll-target="#ancestry-and-foundation-models"><span class="header-section-number">21.3.2</span> Ancestry and Foundation Models</a></li>
  </ul></li>
  <li><a href="#technical-batch-and-platform-effects" id="toc-technical-batch-and-platform-effects" class="nav-link" data-scroll-target="#technical-batch-and-platform-effects"><span class="header-section-number">21.4</span> Technical Batch and Platform Effects</a></li>
  <li><a href="#cohort-institution-and-label-bias" id="toc-cohort-institution-and-label-bias" class="nav-link" data-scroll-target="#cohort-institution-and-label-bias"><span class="header-section-number">21.5</span> Cohort, Institution, and Label Bias</a></li>
  <li><a href="#data-splitting-and-benchmark-leakage" id="toc-data-splitting-and-benchmark-leakage" class="nav-link" data-scroll-target="#data-splitting-and-benchmark-leakage"><span class="header-section-number">21.6</span> Data Splitting and Benchmark Leakage</a>
  <ul class="collapse">
  <li><a href="#types-of-splits" id="toc-types-of-splits" class="nav-link" data-scroll-target="#types-of-splits"><span class="header-section-number">21.6.1</span> Types of Splits</a></li>
  <li><a href="#overlap-and-indirect-leakage" id="toc-overlap-and-indirect-leakage" class="nav-link" data-scroll-target="#overlap-and-indirect-leakage"><span class="header-section-number">21.6.2</span> Overlap and Indirect Leakage</a></li>
  </ul></li>
  <li><a href="#manifestations-of-confounding-in-genomic-models" id="toc-manifestations-of-confounding-in-genomic-models" class="nav-link" data-scroll-target="#manifestations-of-confounding-in-genomic-models"><span class="header-section-number">21.7</span> Manifestations of Confounding in Genomic Models</a></li>
  <li><a href="#diagnostics-and-sanity-checks" id="toc-diagnostics-and-sanity-checks" class="nav-link" data-scroll-target="#diagnostics-and-sanity-checks"><span class="header-section-number">21.8</span> Diagnostics and Sanity Checks</a>
  <ul class="collapse">
  <li><a href="#baseline-models-using-confounders-only" id="toc-baseline-models-using-confounders-only" class="nav-link" data-scroll-target="#baseline-models-using-confounders-only"><span class="header-section-number">21.8.1</span> Baseline Models Using Confounders Only</a></li>
  <li><a href="#subgroup-performance-and-calibration" id="toc-subgroup-performance-and-calibration" class="nav-link" data-scroll-target="#subgroup-performance-and-calibration"><span class="header-section-number">21.8.2</span> Subgroup Performance and Calibration</a></li>
  <li><a href="#predictionconfounder-association" id="toc-predictionconfounder-association" class="nav-link" data-scroll-target="#predictionconfounder-association"><span class="header-section-number">21.8.3</span> Prediction–Confounder Association</a></li>
  <li><a href="#split-sensitivity-analyses" id="toc-split-sensitivity-analyses" class="nav-link" data-scroll-target="#split-sensitivity-analyses"><span class="header-section-number">21.8.4</span> Split Sensitivity Analyses</a></li>
  <li><a href="#negative-controls-and-perturbations" id="toc-negative-controls-and-perturbations" class="nav-link" data-scroll-target="#negative-controls-and-perturbations"><span class="header-section-number">21.8.5</span> Negative Controls and Perturbations</a></li>
  </ul></li>
  <li><a href="#mitigation-strategies" id="toc-mitigation-strategies" class="nav-link" data-scroll-target="#mitigation-strategies"><span class="header-section-number">21.9</span> Mitigation Strategies</a>
  <ul class="collapse">
  <li><a href="#study-design-and-cohort-construction" id="toc-study-design-and-cohort-construction" class="nav-link" data-scroll-target="#study-design-and-cohort-construction"><span class="header-section-number">21.9.1</span> Study Design and Cohort Construction</a></li>
  <li><a href="#covariate-adjustment-and-residualization" id="toc-covariate-adjustment-and-residualization" class="nav-link" data-scroll-target="#covariate-adjustment-and-residualization"><span class="header-section-number">21.9.2</span> Covariate Adjustment and Residualization</a></li>
  <li><a href="#domain-adaptation-and-invariance" id="toc-domain-adaptation-and-invariance" class="nav-link" data-scroll-target="#domain-adaptation-and-invariance"><span class="header-section-number">21.9.3</span> Domain Adaptation and Invariance</a></li>
  <li><a href="#data-curation-and-benchmark-design" id="toc-data-curation-and-benchmark-design" class="nav-link" data-scroll-target="#data-curation-and-benchmark-design"><span class="header-section-number">21.9.4</span> Data Curation and Benchmark Design</a></li>
  </ul></li>
  <li><a href="#fairness-external-validity-and-causal-thinking" id="toc-fairness-external-validity-and-causal-thinking" class="nav-link" data-scroll-target="#fairness-external-validity-and-causal-thinking"><span class="header-section-number">21.10</span> Fairness, External Validity, and Causal Thinking</a></li>
  <li><a href="#a-practical-checklist" id="toc-a-practical-checklist" class="nav-link" data-scroll-target="#a-practical-checklist"><span class="header-section-number">21.11</span> A Practical Checklist</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./p5--eval-interp.html">Part V: Evaluation and Reliability</a></li><li class="breadcrumb-item"><a href="./p5-ch21-confound.html"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Confounders in Model Training</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span id="sec-confound" class="quarto-section-identifier"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Confounders in Model Training</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In previous chapters, we have largely treated model performance curves and ROC plots as if they faithfully reflected how well a model captured biology. Under that view, higher AUC or lower loss is always better, and improvements on a benchmark mean real progress.</p>
<p>This chapter interrogates that assumption.</p>
<p>Genomic datasets are riddled with hidden structure: ancestry, family relatedness, sequencing center, capture kit, hospital system, recruitment year, label curation protocol, and more. These factors correlate with both the features (genotypes, readouts, gene expression, epigenomic marks) and the labels (disease status, variant pathogenicity, expression levels). When such <em>confounders</em> are not explicitly controlled, models, especially large, flexible foundation models, can easily learn shortcuts that exploit them.</p>
<p>Population structure, technical batch effects, benchmark leakage, and label bias are not unique to deep learning; they affect linear regression and logistic models just as much. What makes them particularly dangerous in the foundation model era is scale: larger datasets and more expressive architectures make it easier for models to discover subtle shortcuts that are invisible in standard diagnostics but dramatically hurt out-of-distribution performance.</p>
<p>Our goal in this chapter is not to provide a complete causal inference textbook. Instead, we offer a practical guide for genomic modelers. We examine how to recognize common confounders in genomic and clinical datasets, how these confounders show up in benchmarks and cross-cohort evaluation, how to design splits and experiments that probe real generalization rather than memorization or shortcut learning, how to mitigate confounding via study design, modeling choices, and post-hoc analysis, and how to report results transparently so that readers can assess robustness and fairness.</p>
<p>We will repeatedly cross-reference the benchmark-focused discussion in <a href="p5-ch18-benchmarks.html" class="quarto-xref"><span>Chapter 18</span></a> and the methodological guidance in <a href="p5-ch19-eval.html" class="quarto-xref"><span>Chapter 19</span></a>. Here, the emphasis is on pitfalls: ways models can look impressive on paper while failing to learn the desired biology.</p>
<section id="definitions-confounding-bias-and-leakage" class="level2" data-number="21.1">
<h2 data-number="21.1" class="anchored" data-anchor-id="definitions-confounding-bias-and-leakage"><span class="header-section-number">21.1</span> Definitions: Confounding, Bias, and Leakage</h2>
<p>Before diving into genomics-specific examples, it is helpful to clarify terminology.</p>
<p>A <strong>confounder</strong> is a variable that influences both the input features and the label. For example, ancestry affects allele frequencies across the genome and disease risk via environmental and socioeconomic pathways. If ancestry is not explicitly modeled or controlled, a model trained to predict disease may in fact be learning ancestry.</p>
<p><strong>Bias</strong> refers to a systematic deviation from the quantity we intend to estimate or predict. Bias can result from confounding, but also from measurement error, label definitions, sampling procedures, or deployment differences (for instance, different prevalence in clinical practice versus a case–control study).</p>
<p><strong>Leakage</strong> occurs when information about the test set inadvertently influences model training or selection. Leakage can occur through overlapping individuals or variants, shared families, duplicated samples, or indirect channels such as pretraining on a resource that is later used as a benchmark.</p>
<p><strong>Distribution shift</strong> is a mismatch between the data distribution used for training and the distribution encountered during evaluation or deployment. Shift can be driven by changes in ancestry composition, sequencing technology, clinical coding practices, or temporal trends in care.</p>
<p>These phenomena are intertwined. Confounders create biases in estimated effects and predictions. Leakage can hide those biases by making held-out performance look better than it should. Distribution shifts then cause performance to collapse when a model is deployed outside the environment in which its shortcuts were learned.</p>
<p>For genomic foundation models, these risks are magnified by three features. First, high-dimensional structure means that genomes encode ancestry, relatedness, and assay conditions in thousands of subtle ways, even if we never explicitly provide those labels. Second, powerful pattern detection means that shallow models might miss some shortcuts, but large transformers will find them if they help optimize the training objective. Third, complex training regimes involving pretraining on biobank-scale data, followed by fine-tuning on curated labels and evaluation on community benchmarks, create many opportunities for direct and indirect leakage.</p>
</section>
<section id="a-taxonomy-of-confounders-in-genomic-data" class="level2" data-number="21.2">
<h2 data-number="21.2" class="anchored" data-anchor-id="a-taxonomy-of-confounders-in-genomic-data"><span class="header-section-number">21.2</span> A Taxonomy of Confounders in Genomic Data</h2>
<p>Confounders in genomic modeling can be grouped into several broad categories. The same variable, say recruitment site, may simultaneously induce ancestry differences, batch effects, and label bias.</p>
<p><strong>Population structure and relatedness</strong> includes continental and sub-continental ancestry, family relatedness (siblings, parent–offspring, cryptic relatedness), and founder effects with local haplotype structure.</p>
<p><strong>Technical batch and platform effects</strong> arise from sequencing center, instrument, capture kit, and library preparation protocol. Different read lengths, coverage patterns, aligners, and variant callers introduce systematic differences. Distinct assay chemistries for DNA, RNA, or epigenomic profiling further complicate matters.</p>
<p><strong>Cohort and institution effects</strong> reflect hospital systems with different patient populations and coding practices, biobank-specific inclusion and exclusion criteria, and ascertainment patterns (referral centers versus population-based studies).</p>
<p><strong>Label and curation bias</strong> stems from clinical labels derived from billing codes, problem lists, or registry entries. Variant pathogenicity labels from ClinVar and similar databases reflect expert curation, test panels, and past literature biases <span class="citation" data-cites="landrum_clinvar_2018">(<a href="references.html#ref-landrum_clinvar_2018" role="doc-biblioref">Landrum et al. 2018</a>)</span>. Expression, regulatory, or splicing labels derived from specific tissues or cell lines carry their own limitations <span class="citation" data-cites="gtex_2020 kagda_encode_2025">(<a href="references.html#ref-gtex_2020" role="doc-biblioref">The GTEx Consortium 2020</a>; <a href="references.html#ref-kagda_encode_2025" role="doc-biblioref">Kagda et al. 2025</a>)</span>.</p>
<p><strong>Temporal drift</strong> includes changes in clinical practice, diagnostic criteria, or coding over time, evolving sequencing technologies and QC pipelines, and shifts in population behavior or environment.</p>
<p><strong>Knowledge-base and benchmark leakage</strong> involves using resources like gnomAD <span class="citation" data-cites="karczewski_gnomad_2020">(<a href="references.html#ref-karczewski_gnomad_2020" role="doc-biblioref">Karczewski et al. 2020</a>)</span> or UK Biobank <span class="citation" data-cites="bycroft_ukbiobank_2018">(<a href="references.html#ref-bycroft_ukbiobank_2018" role="doc-biblioref">Bycroft et al. 2018</a>)</span> in both model training and evaluation, or reusing curated variant sets across multiple publications and tasks.</p>
<p>Many of these factors are present simultaneously in large-scale genomic resources and biobanks. Ignoring them leads to deceptively strong benchmark performance and brittle behavior when models are deployed in new contexts.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Visual suggestion:</strong> A comprehensive table summarizing confounder categories (population, technical, cohort, label, temporal, knowledge-base leakage) with columns for “Example variables”, “Common manifestations in genomic data”, “Diagnostics”, and “Mitigation strategies” would provide readers with a practical reference.</p>
</div>
</div>
</section>
<section id="population-structure-and-ancestry-as-shortcuts" class="level2" data-number="21.3">
<h2 data-number="21.3" class="anchored" data-anchor-id="population-structure-and-ancestry-as-shortcuts"><span class="header-section-number">21.3</span> Population Structure and Ancestry as Shortcuts</h2>
<section id="how-ancestry-becomes-a-confounder" class="level3" data-number="21.3.1">
<h3 data-number="21.3.1" class="anchored" data-anchor-id="how-ancestry-becomes-a-confounder"><span class="header-section-number">21.3.1</span> How Ancestry Becomes a Confounder</h3>
<p>Human genetic variation is structured by ancestry: allele frequencies, haplotype blocks, and linkage disequilibrium patterns differ across populations. Principal components (PCs) computed from genome-wide genotypes provide a low-dimensional summary of this structure and are now standard in genome-wide association studies (GWAS) to correct for stratification <span class="citation" data-cites="patterson_population_2006 price_pca_2006">(<a href="references.html#ref-patterson_population_2006" role="doc-biblioref">Patterson, Price, and Reich 2006</a>; <a href="references.html#ref-price_pca_2006" role="doc-biblioref">Price et al. 2006</a>)</span>.</p>
<p>Ancestry, however, is not just a convenient statistical nuisance. It is intertwined with geography, environment, socioeconomic status, and access to healthcare. These factors directly impact disease risk, phenotyping, and the likelihood of receiving genetic testing. Thus, ancestry influences both features (the genome) and labels (phenotypes and clinical annotations), creating classic confounding.</p>
<p>For example, a rare disease clinic serving primarily individuals of European ancestry may contribute most pathogenic variants in ClinVar, while variants observed predominantly in other ancestries remain labelled as variants of uncertain significance (VUS) <span class="citation" data-cites="landrum_clinvar_2018">(<a href="references.html#ref-landrum_clinvar_2018" role="doc-biblioref">Landrum et al. 2018</a>)</span>. Biobanks enriched for particular ancestries, birth cohorts, or health systems introduce subtle differences in both genotype and phenotype distributions <span class="citation" data-cites="bycroft_ukbiobank_2018">(<a href="references.html#ref-bycroft_ukbiobank_2018" role="doc-biblioref">Bycroft et al. 2018</a>)</span>.</p>
<p>A model trained on such data may appear to excel at predicting disease risk or variant pathogenicity, while in reality it has learned to infer ancestry and exploit its correlation with label definitions and clinical practice.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Visual suggestion:</strong> A causal diagram or schematic showing ancestry influencing both genotype and environment/clinical practice, which in turn influence disease labels, would clarify where a model might pick up shortcuts (predicting ancestry instead of biology).</p>
</div>
</div>
</section>
<section id="ancestry-and-foundation-models" class="level3" data-number="21.3.2">
<h3 data-number="21.3.2" class="anchored" data-anchor-id="ancestry-and-foundation-models"><span class="header-section-number">21.3.2</span> Ancestry and Foundation Models</h3>
<p>Foundation models trained directly on nucleotide sequences or variant streams clearly see ancestry information: the distribution of k-mers and haplotypes differs by population <span class="citation" data-cites="he_nucleic_2023">(<a href="references.html#ref-he_nucleic_2023" role="doc-biblioref">He et al. 2023</a>)</span>. When such models are fine-tuned to predict disease risk, expression, or pathogenicity, they may leverage this ancestry signal as an easy shortcut.</p>
<p>Multi-ancestry GWAS and polygenic score studies underscore the magnitude of these issues. Risk scores derived from primarily European cohorts often transfer poorly to other ancestries, with attenuated performance and systematic miscalibration <span class="citation" data-cites="ishigaki_multi-ancestry_2022">(<a href="references.html#ref-ishigaki_multi-ancestry_2022" role="doc-biblioref">Ishigaki et al. 2022</a>)</span>. Similar pitfalls arise when genomic foundation models are trained or validated in ancestry-skewed datasets.</p>
<p>Crucially, increasing model capacity does not automatically solve ancestry bias; it can make it worse by making it easier to detect and exploit subtle ancestry-linked features. Robust evaluation must therefore probe performance within and across ancestry groups, not just overall metrics.</p>
</section>
</section>
<section id="technical-batch-and-platform-effects" class="level2" data-number="21.4">
<h2 data-number="21.4" class="anchored" data-anchor-id="technical-batch-and-platform-effects"><span class="header-section-number">21.4</span> Technical Batch and Platform Effects</h2>
<p>Technical pipelines are complex. Each step from sample collection through library preparation, sequencing, alignment, and variant calling can introduce systematic differences that act as confounders.</p>
<p>Different sequencing centers use distinct instruments, reagents, and QC thresholds. Library preparation protocols vary in GC bias and coverage profiles. Capture kits and read lengths change the probability of calling variants in specific genomic regions. Assay platforms for epigenomics, expression, or chromatin conformation have distinct noise and bias characteristics.</p>
<p>When samples from a particular batch or platform are disproportionately drawn from a specific label class (say, cases sequenced at one center and controls at another), models can learn to distinguish batches rather than biology. In high-dimensional feature spaces, even subtle batch-specific artifacts (coverage dips, variant density patterns, adapter content) can be exploited.</p>
<p>Foundation models are particularly sensitive: pretraining on raw reads, read piles, or coverage tracks makes it easy to detect batch signatures unless preprocessing and normalization are carefully handled.</p>
<p>Common patterns include clustering by batch or sequencing center when embedding outputs or PCs are visualized, strong predictive performance that collapses when evaluated on data from a new center, instrument, or protocol, and models that can nearly perfectly predict batch ID, platform, or capture kit from the inputs alone.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Visual suggestion:</strong> A PCA or UMAP of sample embeddings colored by batch or sequencing center (left panel) versus labeled phenotype (right panel) would illustrate strong batch structure relative to signal-of-interest.</p>
</div>
</div>
</section>
<section id="cohort-institution-and-label-bias" class="level2" data-number="21.5">
<h2 data-number="21.5" class="anchored" data-anchor-id="cohort-institution-and-label-bias"><span class="header-section-number">21.5</span> Cohort, Institution, and Label Bias</h2>
<p>Beyond ancestry and technical factors, cohort and institution choices introduce additional confounding.</p>
<p><strong>Cohort effects</strong> arise because population-based cohorts differ from hospital-based or referral cohorts in terms of disease prevalence, comorbidities, and socio-demographic composition.</p>
<p><strong>Institutional practices</strong> vary across hospitals and clinics, which use distinct coding practices, diagnostic thresholds, and follow-up schedules. These alter labels derived from electronic health records.</p>
<p><strong>Ascertainment and testing bias</strong> means that individuals who receive genome sequencing or panel testing may be more severely affected, more affluent, or preferentially from particular ancestry groups.</p>
<p>Label sources further complicate matters. Claims-based phenotypes and ICD codes can be noisy and incomplete. Registries and expert-curated variant databases may lag behind current knowledge and reflect historical focus areas <span class="citation" data-cites="landrum_clinvar_2018">(<a href="references.html#ref-landrum_clinvar_2018" role="doc-biblioref">Landrum et al. 2018</a>)</span>. Functional assay readouts often depend on specific cell lines, overexpression systems, or environmental conditions, which may not generalize.</p>
<p>For genomic foundation models that aspire to downstream clinical utility, these biases can dominate the training signal. Without careful design, models may simply reproduce institutional practices and historical biases rather than underlying biology.</p>
</section>
<section id="data-splitting-and-benchmark-leakage" class="level2" data-number="21.6">
<h2 data-number="21.6" class="anchored" data-anchor-id="data-splitting-and-benchmark-leakage"><span class="header-section-number">21.6</span> Data Splitting and Benchmark Leakage</h2>
<p>Data splitting is one of the primary tools we have to assess generalization. However, naive splits can silently allow leakage and confounding.</p>
<section id="types-of-splits" class="level3" data-number="21.6.1">
<h3 data-number="21.6.1" class="anchored" data-anchor-id="types-of-splits"><span class="header-section-number">21.6.1</span> Types of Splits</h3>
<p>Common splitting strategies include several approaches. <strong>Random individual-level splits</strong> assign individuals randomly to train, validation, and test sets. <strong>Family-aware splits</strong> keep families together to avoid relatedness leakage across splits. <strong>Locus-level splits</strong> keep variants at the same genomic position, and often in close proximity, within the same split to prevent models from memorizing site-specific patterns. <strong>Region or chromosome splits</strong> hold out entire genomic regions or chromosomes to assess long-range generalization. <strong>Cohort or site splits</strong> hold out entire cohorts, sequencing centers, or hospitals to probe robustness across institutions. <strong>Time-based splits</strong> use earlier data for training and hold out later data to simulate prospective performance and account for temporal drift.</p>
<p>Each strategy targets specific forms of leakage and confounding. Unfortunately, many benchmarks rely on random individual-level splits that allow information leakage across families, loci, or cohorts.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Visual suggestion:</strong> A figure comparing different splitting strategies (random individual, family-aware, locus-level, chromosome, cohort, time-based) and highlighting which leakage pathways each prevents would be instructive. Consider a timeline or schematic genome diagram with color-coded splits.</p>
</div>
</div>
</section>
<section id="overlap-and-indirect-leakage" class="level3" data-number="21.6.2">
<h3 data-number="21.6.2" class="anchored" data-anchor-id="overlap-and-indirect-leakage"><span class="header-section-number">21.6.2</span> Overlap and Indirect Leakage</h3>
<p>Leakage need not be explicit. A few common patterns in variant effect prediction and risk modeling include variant overlap across resources, where variants used for training may also appear in external benchmarking datasets (for instance, ClinVar variants used during model development, then again in downstream evaluation), even if the exact label is not reused. Relatedness across splits allows close relatives of test individuals to appear in the training set, letting models memorize segments of the genome and inflate apparent performance on rare variants. Knowledge-base pretraining occurs when models pre-trained on resources like gnomAD allele frequencies or UK Biobank genotype–phenotype associations <span class="citation" data-cites="karczewski_gnomad_2020 bycroft_ukbiobank_2018">(<a href="references.html#ref-karczewski_gnomad_2020" role="doc-biblioref">Karczewski et al. 2020</a>; <a href="references.html#ref-bycroft_ukbiobank_2018" role="doc-biblioref">Bycroft et al. 2018</a>)</span> are later evaluated on benchmarks built from the same data without explicitly acknowledging that this constitutes leakage.</p>
<p>These issues are particularly acute for community benchmarks that reuse widely popular variant sets. Without rigorous deduplication and splitting at the locus or individual level, performance may primarily reflect memorization.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Case study suggestion:</strong> An example of benchmark leakage in a variant effect prediction task, illustrating how deduplicating variants across training and benchmark sets causes a noticeable drop in AUC, would reveal prior over-optimism and make the concept concrete.</p>
</div>
</div>
</section>
</section>
<section id="manifestations-of-confounding-in-genomic-models" class="level2" data-number="21.7">
<h2 data-number="21.7" class="anchored" data-anchor-id="manifestations-of-confounding-in-genomic-models"><span class="header-section-number">21.7</span> Manifestations of Confounding in Genomic Models</h2>
<p>How can we tell when confounding is driving performance?</p>
<p>Some common signatures include performance gaps across subgroups, where models exhibit high overall performance but much worse metrics in under-represented ancestry groups, sequencing centers, or time periods. Prediction–confounder correlation occurs when model outputs are strongly correlated with ancestry PCs, batch indicators, or recruitment site, even after conditioning on the label. Performance collapse under cohort or time-based splits happens when models that perform well under random splits show sharp degradation when evaluated on held-out cohorts or later time windows. Simple confounder-only baselines performing comparably means that logistic regression on ancestry PCs, batch IDs, or site indicators alone achieves performance close to that of a complex model.</p>
<p>These signatures are not proofs of confounding, but they are red flags that should trigger deeper investigation.</p>
<p>For genomic foundation models, additional manifestations include token and embedding structure dominated by confounders, where sequence or variant embeddings cluster by ancestry or batch rather than by biological similarity. Contextual embeddings may track institutional labels, with models fine-tuned on EHR-linked genomics encoding institutional coding practices more strongly than underlying phenotypes.</p>
<p>The key lesson is that good performance on a single benchmark, especially with random splits and without subgroup analysis, is insufficient evidence that a model has learned robust, biologically meaningful patterns.</p>
</section>
<section id="diagnostics-and-sanity-checks" class="level2" data-number="21.8">
<h2 data-number="21.8" class="anchored" data-anchor-id="diagnostics-and-sanity-checks"><span class="header-section-number">21.8</span> Diagnostics and Sanity Checks</h2>
<p>Because confounding is often subtle, we need systematic diagnostics.</p>
<section id="baseline-models-using-confounders-only" class="level3" data-number="21.8.1">
<h3 data-number="21.8.1" class="anchored" data-anchor-id="baseline-models-using-confounders-only"><span class="header-section-number">21.8.1</span> Baseline Models Using Confounders Only</h3>
<p>An essential check is to train simple models using only potential confounders. This includes logistic regression on ancestry PCs and basic covariates, gradient boosting trees on technical variables (batch, sequencing center, capture kit), and models using only cohort or site indicators.</p>
<p>If these baselines approach the performance of complex genomic models, a substantial portion of the signal is likely driven by confounding. Reporting these baselines alongside genomic models makes hidden shortcuts more visible.</p>
</section>
<section id="subgroup-performance-and-calibration" class="level3" data-number="21.8.2">
<h3 data-number="21.8.2" class="anchored" data-anchor-id="subgroup-performance-and-calibration"><span class="header-section-number">21.8.2</span> Subgroup Performance and Calibration</h3>
<p>Performance should be reported stratified by ancestry or population group, sequencing center or platform, cohort, institution, or country, and time period.</p>
<p>This includes both discrimination metrics (AUC, precision–recall) and calibration diagnostics. Poor calibration or systematic over- or under-prediction in specific subgroups often reveals confounding or distribution shift.</p>
</section>
<section id="predictionconfounder-association" class="level3" data-number="21.8.3">
<h3 data-number="21.8.3" class="anchored" data-anchor-id="predictionconfounder-association"><span class="header-section-number">21.8.3</span> Prediction–Confounder Association</h3>
<p>Plotting model predictions against potential confounders can be revealing. Look for correlations between predicted risk and ancestry PCs after adjusting for true status, differences in mean predicted risk across batches, sites, or time periods within the same label class, and association tests using regression or mutual information between predictions and confounders.</p>
<p>Strong residual associations indicate that the model is encoding confounders beyond what is needed to predict the label.</p>
</section>
<section id="split-sensitivity-analyses" class="level3" data-number="21.8.4">
<h3 data-number="21.8.4" class="anchored" data-anchor-id="split-sensitivity-analyses"><span class="header-section-number">21.8.4</span> Split Sensitivity Analyses</h3>
<p>Varying the splitting strategy is a powerful diagnostic. Re-evaluate performance under locus-level or chromosome-level splits, hold out entire cohorts, sites, or time windows, and exclude families or closely related individuals from test sets.</p>
<p>Large drops in performance under stricter splits suggest that initial results were inflated by leakage or confounding.</p>
</section>
<section id="negative-controls-and-perturbations" class="level3" data-number="21.8.5">
<h3 data-number="21.8.5" class="anchored" data-anchor-id="negative-controls-and-perturbations"><span class="header-section-number">21.8.5</span> Negative Controls and Perturbations</h3>
<p>Finally, negative controls and simple perturbations can help. Use outcome labels known to be unrelated to genomics as negative controls; good performance suggests confounding. Randomize labels within batches or ancestry strata and confirm that models cannot achieve meaningful performance. Remove suspected confounder variables (when explicitly present) or residualize features and compare performance.</p>
<p>These diagnostics do not remove confounding, but they help quantify its impact and guide mitigation efforts.</p>
</section>
</section>
<section id="mitigation-strategies" class="level2" data-number="21.9">
<h2 data-number="21.9" class="anchored" data-anchor-id="mitigation-strategies"><span class="header-section-number">21.9</span> Mitigation Strategies</h2>
<p>No mitigation strategy is perfect, and trade-offs between bias, variance, and coverage are inevitable. Nonetheless, several practical approaches can substantially reduce confounding.</p>
<section id="study-design-and-cohort-construction" class="level3" data-number="21.9.1">
<h3 data-number="21.9.1" class="anchored" data-anchor-id="study-design-and-cohort-construction"><span class="header-section-number">21.9.1</span> Study Design and Cohort Construction</h3>
<p>Good design beats clever modeling. Match cases and controls on age, sex, ancestry PCs, and recruitment site where possible to reduce confounding by these factors. Use balanced sampling to down-sample dominant groups or up-sample under-represented groups within mini-batches to prevent models from over-relying on majority patterns. For new studies, plan recruitment prospectively to ensure diversity across ancestries, institutions, and environments.</p>
<p>Matched designs and balanced sampling reduce the incentive for models to use confounders, though they may limit effective sample size.</p>
</section>
<section id="covariate-adjustment-and-residualization" class="level3" data-number="21.9.2">
<h3 data-number="21.9.2" class="anchored" data-anchor-id="covariate-adjustment-and-residualization"><span class="header-section-number">21.9.2</span> Covariate Adjustment and Residualization</h3>
<p>Explicitly modeling confounders can help. Include ancestry PCs, batch indicators, or site variables as covariates in regression or generalized linear models. Residualize phenotypes with respect to known confounders before training genetic models, while being cautious not to remove genuine biological signal. Use mixed models or hierarchical structures to model institution or batch as random effects.</p>
<p>These approaches are well-established in GWAS and can be adapted to genomic foundation model pipelines.</p>
</section>
<section id="domain-adaptation-and-invariance" class="level3" data-number="21.9.3">
<h3 data-number="21.9.3" class="anchored" data-anchor-id="domain-adaptation-and-invariance"><span class="header-section-number">21.9.3</span> Domain Adaptation and Invariance</h3>
<p>More advanced approaches aim to learn representations that are invariant to confounders. Adversarial training involves training a feature extractor such that a discriminator cannot recover batch, site, or ancestry labels from the learned representation, promoting invariance. Domain adaptation uses techniques such as domain adversarial networks or importance weighting to align distributions across batches or cohorts. Group-robust optimization optimizes worst-group performance (for instance, worst-ancestry AUC) rather than average performance, encouraging robust models.</p>
<p>These methods are not a substitute for careful design, but they can reduce reliance on confounders when distribution alignment is feasible.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Visual suggestion:</strong> A small schematic illustrating adversarial domain adaptation for batch correction (encoder → predictor and encoder → batch discriminator, with gradient reversal on the discriminator branch) would clarify this technique.</p>
</div>
</div>
</section>
<section id="data-curation-and-benchmark-design" class="level3" data-number="21.9.4">
<h3 data-number="21.9.4" class="anchored" data-anchor-id="data-curation-and-benchmark-design"><span class="header-section-number">21.9.4</span> Data Curation and Benchmark Design</h3>
<p>Mitigation also depends on how we build benchmarks and curate datasets. Deduplicate individuals, families, and variants across training, validation, and benchmark sets. Use locus-level or chromosome-level splits in variant effect prediction to avoid memorization of sites. Construct benchmarks that explicitly include diverse ancestries, cohorts, and platforms, rather than reusing a single dominant dataset. Document known overlaps or shared resources between training data and benchmarks, clearly flagging potential leakage.</p>
<p>These principles complement the methodological guidance in <a href="p5-ch18-benchmarks.html" class="quarto-xref"><span>Chapter 18</span></a> and <a href="p5-ch19-eval.html" class="quarto-xref"><span>Chapter 19</span></a>, focusing them on confounding and bias.</p>
</section>
</section>
<section id="fairness-external-validity-and-causal-thinking" class="level2" data-number="21.10">
<h2 data-number="21.10" class="anchored" data-anchor-id="fairness-external-validity-and-causal-thinking"><span class="header-section-number">21.10</span> Fairness, External Validity, and Causal Thinking</h2>
<p>Confounding and bias are intimately connected to questions of fairness and external validity.</p>
<p>Models that primarily serve majority ancestry groups exacerbate health disparities, even if they show excellent overall performance. Biases in ClinVar-like resources and biobank recruitment can lock in historical inequities, with pathogenic variants in under-studied groups remaining poorly characterized <span class="citation" data-cites="landrum_clinvar_2018 karczewski_gnomad_2020">(<a href="references.html#ref-landrum_clinvar_2018" role="doc-biblioref">Landrum et al. 2018</a>; <a href="references.html#ref-karczewski_gnomad_2020" role="doc-biblioref">Karczewski et al. 2020</a>)</span>. Multi-ancestry GWAS and polygenic score studies highlight both the need for broad representation and the difficulty of building models that generalize across ancestries <span class="citation" data-cites="ishigaki_multi-ancestry_2022">(<a href="references.html#ref-ishigaki_multi-ancestry_2022" role="doc-biblioref">Ishigaki et al. 2022</a>)</span>.</p>
<p>Causal representation learning aims to separate invariant mechanisms from spurious correlations <span class="citation" data-cites="chen_causal_2025">(<a href="references.html#ref-chen_causal_2025" role="doc-biblioref">Chen 2025</a>)</span>. While still an active research area, this perspective is useful: robust genomic foundation models should capture relationships that hold across ancestries, cohorts, and technical platforms, rather than those specific to a single dataset.</p>
<p>In practice, this means prioritizing cross-cohort and cross-ancestry evaluation, designing objectives and benchmarks that emphasize out-of-distribution robustness, and being explicit about which populations and settings a model is expected to work in, and where uncertainty remains.</p>
</section>
<section id="a-practical-checklist" class="level2" data-number="21.11">
<h2 data-number="21.11" class="anchored" data-anchor-id="a-practical-checklist"><span class="header-section-number">21.11</span> A Practical Checklist</h2>
<p>To close, here is a concise checklist to apply when designing, training, and evaluating genomic models.</p>
<p><strong>Population structure and relatedness</strong></p>
<ul>
<li>Quantify ancestry and relatedness via PCs, kinship estimates, or other appropriate methods.</li>
<li>Decide whether to match, stratify, or adjust for ancestry and relatedness, and justify that choice.</li>
<li>Report performance stratified by ancestry and, when relevant, by family structure (for instance, presence of close relatives in the training data).</li>
</ul>
<p><strong>Data splits and leakage</strong></p>
<ul>
<li>Ensure that individuals, families, and loci do not cross the train–validation–test boundaries for the target tasks.</li>
<li>Consider stricter splits (locus-level, chromosome-level, cohort- or time-based) to probe for leakage.</li>
<li>Check for overlap with external databases or benchmarks used in evaluation and clearly document any shared resources.</li>
</ul>
<p><strong>Batch, platform, and cohort effects</strong></p>
<ul>
<li>Catalog technical variables (center, instrument, protocol, assay) and cohort or institution identifiers.</li>
<li>Evaluate whether these variables align with labels or subgroups of interest.</li>
<li>Use diagnostics (embeddings, PCs, simple classifiers) to detect batch or cohort signatures and mitigate via design, adjustment, or domain adaptation.</li>
</ul>
<p><strong>Label quality and curation bias</strong></p>
<ul>
<li>Understand how labels were defined and what processes (billing codes, expert review, registry inclusion) produced them.</li>
<li>Quantify label noise where possible, and consider robust training strategies when labels are noisy.</li>
<li>Be explicit about how curated resources (for instance, ClinVar, functional assay datasets) may reflect historical biases.</li>
</ul>
<p><strong>Cross-group performance and fairness</strong></p>
<ul>
<li>Report metrics for each major subgroup (ancestry, sex, age, cohort, platform) rather than only overall metrics.</li>
<li>Examine calibration and error patterns across groups, not just discrimination metrics.</li>
<li>Discuss the ethical and clinical implications of residual performance gaps, including whether deployment might exacerbate existing disparities.</li>
</ul>
<p><strong>Reproducibility and transparency</strong></p>
<ul>
<li>Fully document dataset construction, inclusion criteria, and all splitting strategies used.</li>
<li>Release code and configuration files for preprocessing, model training, and evaluation where feasible.</li>
<li>Clearly describe which confounders were measured, how they were handled, and what limitations remain.</li>
</ul>
<p>By systematically addressing these points, we can move beyond models that merely perform well on convenient benchmarks to models that reveal genuine biology and behave reliably in diverse clinical and scientific settings.</p>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-bycroft_ukbiobank_2018" class="csl-entry" role="listitem">
Bycroft, Clare, Colin Freeman, Desislava Petkova, Gavin Band, Lloyd T. Elliott, Kevin Sharp, Allan Motyer, et al. 2018. <span>“The <span>UK</span> <span>Biobank</span> Resource with Deep Phenotyping and Genomic Data.”</span> <em>Nature</em> 562 (7726): 203–9. <a href="https://doi.org/10.1038/s41586-018-0579-z">https://doi.org/10.1038/s41586-018-0579-z</a>.
</div>
<div id="ref-chen_causal_2025" class="csl-entry" role="listitem">
Chen, Liyin. 2025. <span>“Causal <span>Genomics</span> in the <span>Deep</span> <span>Learning</span> <span>Era</span>.”</span> MDPI AG. <a href="https://doi.org/10.20944/preprints202503.2081.v1">https://doi.org/10.20944/preprints202503.2081.v1</a>.
</div>
<div id="ref-he_nucleic_2023" class="csl-entry" role="listitem">
He, Shujun, Baizhen Gao, Rushant Sabnis, and Qing Sun. 2023. <span>“Nucleic <span>Transformer</span>: <span>Classifying</span> <span>DNA</span> <span>Sequences</span> with <span>Self</span>-<span>Attention</span> and <span>Convolutions</span>.”</span> <em>ACS Synthetic Biology</em> 12 (11): 3205–14. <a href="https://doi.org/10.1021/acssynbio.3c00154">https://doi.org/10.1021/acssynbio.3c00154</a>.
</div>
<div id="ref-ishigaki_multi-ancestry_2022" class="csl-entry" role="listitem">
Ishigaki, Kazuyoshi, Saori Sakaue, Chikashi Terao, Yang Luo, Kyuto Sonehara, Kensuke Yamaguchi, Tiffany Amariuta, et al. 2022. <span>“Multi-Ancestry Genome-Wide Association Analyses Identify Novel Genetic Mechanisms in Rheumatoid Arthritis.”</span> <em>Nature Genetics</em> 54 (11): 1640–51. <a href="https://doi.org/10.1038/s41588-022-01213-w">https://doi.org/10.1038/s41588-022-01213-w</a>.
</div>
<div id="ref-kagda_encode_2025" class="csl-entry" role="listitem">
Kagda, Meenakshi S., Bonita Lam, Casey Litton, Corinn Small, Cricket A. Sloan, Emma Spragins, Forrest Tanaka, et al. 2025. <span>“Data Navigation on the <span>ENCODE</span> Portal.”</span> <em>Nature Communications</em> 16 (1): 9592. <a href="https://doi.org/10.1038/s41467-025-64343-9">https://doi.org/10.1038/s41467-025-64343-9</a>.
</div>
<div id="ref-karczewski_gnomad_2020" class="csl-entry" role="listitem">
Karczewski, Konrad J., Laurent C. Francioli, Grace Tiao, Beryl B. Cummings, Jessica Alföldi, Qingbo Wang, Ryan L. Collins, et al. 2020. <span>“The Mutational Constraint Spectrum Quantified from Variation in 141,456 Humans.”</span> <em>Nature</em> 581 (7809): 434–43. <a href="https://doi.org/10.1038/s41586-020-2308-7">https://doi.org/10.1038/s41586-020-2308-7</a>.
</div>
<div id="ref-landrum_clinvar_2018" class="csl-entry" role="listitem">
Landrum, Melissa J, Jennifer M Lee, Mark Benson, Garth R Brown, Chen Chao, Shanmuga Chitipiralla, Baoshan Gu, et al. 2018. <span>“<span>ClinVar</span>: Improving Access to Variant Interpretations and Supporting Evidence.”</span> <em>Nucleic Acids Research</em> 46 (D1): D1062–67. <a href="https://doi.org/10.1093/nar/gkx1153">https://doi.org/10.1093/nar/gkx1153</a>.
</div>
<div id="ref-patterson_population_2006" class="csl-entry" role="listitem">
Patterson, Nick, Alkes L. Price, and David Reich. 2006. <span>“Population <span>Structure</span> and <span>Eigenanalysis</span>.”</span> <em>PLOS Genetics</em> 2 (12): e190. <a href="https://doi.org/10.1371/journal.pgen.0020190">https://doi.org/10.1371/journal.pgen.0020190</a>.
</div>
<div id="ref-price_pca_2006" class="csl-entry" role="listitem">
Price, Alkes L., Nick J. Patterson, Robert M. Plenge, Michael E. Weinblatt, Nancy A. Shadick, and David Reich. 2006. <span>“Principal Components Analysis Corrects for Stratification in Genome-Wide Association Studies.”</span> <em>Nature Genetics</em> 38 (8): 904–9. <a href="https://doi.org/10.1038/ng1847">https://doi.org/10.1038/ng1847</a>.
</div>
<div id="ref-gtex_2020" class="csl-entry" role="listitem">
The GTEx Consortium. 2020. <span>“The <span>GTEx</span> <span>Consortium</span> Atlas of Genetic Regulatory Effects Across Human Tissues.”</span> <em>Science</em> 369 (6509): 1318–30. <a href="https://doi.org/10.1126/science.aaz1776">https://doi.org/10.1126/science.aaz1776</a>.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./p5-ch20-vep.html" class="pagination-link" aria-label="Variant Effect Prediction">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Variant Effect Prediction</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./p5-ch22-interp.html" class="pagination-link" aria-label="Interpretability &amp; Mechanisms">
        <span class="nav-page-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Interpretability &amp; Mechanisms</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Copyright 2025, Josh Meehl</p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>