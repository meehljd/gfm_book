<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>17&nbsp; Interpretability &amp; Mechanisms – Genomic Foundation Models</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./p6-ch18-clinical.html" rel="next">
<link href="./p5-ch16-confound.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-b758ccaa5987ceb1b75504551e579abf.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-a1553387a0f784068632030e9fbb8a3c.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark-d1e9b63c6b6094879b9f94a7628e3370.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="site_libs/bootstrap/bootstrap-a1553387a0f784068632030e9fbb8a3c.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar floating quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./p5-ch15-eval.html">Part V: Reliability &amp; Interpretation</a></li><li class="breadcrumb-item"><a href="./p5-ch17-interp.html"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Interpretability &amp; Mechanisms</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Genomic Foundation Models</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Part I: Data &amp; Pre-DL Methods</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p1-ch01-ngs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">NGS &amp; Variant Calling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p1-ch02-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Foundational Genomics Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p1-ch03-pgs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">GWAS &amp; Polygenic Scores</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p1-ch04-cadd.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Deleteriousness Scores</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Part II: CNN Seq-to-Function Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p2-ch05-reg.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Regulatory Prediction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p2-ch06-transc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Transcriptional Effects</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p2-ch07-splice.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Splicing Prediction</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Part III: Transformers Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p3-ch08-tokens.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Sequence Representation &amp; Tokens</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p3-ch09-plm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Protein Language Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p3-ch10-glm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">DNA Foundation Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p3-ch11-hybrid.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Long-range Hybrid Model</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Part IV: GFMs &amp; Multi-omics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p4-ch12-principles.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Genomic FMs: Principles &amp; Practice</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p4-ch13-vep.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Variant Effect Prediction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p4-ch14-omics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Multi-omics &amp; Systems Context</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Part V: Reliability &amp; Interpretation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p5-ch15-eval.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Model Evaluation &amp; Benchmarks</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p5-ch16-confound.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Confounders in Model Training</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p5-ch17-interp.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Interpretability &amp; Mechanisms</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Part VI: Applications</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p6-ch18-clinical.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Clinical Risk Prediction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p6-ch19-variants.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Pathogenic Variant Discovery</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p6-ch20-drugs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Drug Discovery &amp; Biotech</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app-a-dl.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Deep Learning Primer for Genomics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app-b-resources.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Additional Resources</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#why-interpretability-matters-for-genomic-models" id="toc-why-interpretability-matters-for-genomic-models" class="nav-link active" data-scroll-target="#why-interpretability-matters-for-genomic-models"><span class="header-section-number">17.1</span> Why Interpretability Matters for Genomic Models</a></li>
  <li><a href="#interpreting-convolutional-filters-as-motifs" id="toc-interpreting-convolutional-filters-as-motifs" class="nav-link" data-scroll-target="#interpreting-convolutional-filters-as-motifs"><span class="header-section-number">17.2</span> Interpreting Convolutional Filters as Motifs</a>
  <ul class="collapse">
  <li><a href="#from-filters-to-motif-logos" id="toc-from-filters-to-motif-logos" class="nav-link" data-scroll-target="#from-filters-to-motif-logos"><span class="header-section-number">17.2.1</span> From Filters to Motif Logos</a></li>
  <li><a href="#beyond-first-layer-filters" id="toc-beyond-first-layer-filters" class="nav-link" data-scroll-target="#beyond-first-layer-filters"><span class="header-section-number">17.2.2</span> Beyond First-Layer Filters</a></li>
  </ul></li>
  <li><a href="#attribution-methods-connecting-bases-to-predictions" id="toc-attribution-methods-connecting-bases-to-predictions" class="nav-link" data-scroll-target="#attribution-methods-connecting-bases-to-predictions"><span class="header-section-number">17.3</span> Attribution Methods: Connecting Bases to Predictions</a>
  <ul class="collapse">
  <li><a href="#in-silico-mutagenesis-ism" id="toc-in-silico-mutagenesis-ism" class="nav-link" data-scroll-target="#in-silico-mutagenesis-ism"><span class="header-section-number">17.3.1</span> In Silico Mutagenesis (ISM)</a></li>
  <li><a href="#gradient-based-methods" id="toc-gradient-based-methods" class="nav-link" data-scroll-target="#gradient-based-methods"><span class="header-section-number">17.3.2</span> Gradient-Based Methods</a></li>
  </ul></li>
  <li><a href="#from-attributions-to-motifs-tf-modisco" id="toc-from-attributions-to-motifs-tf-modisco" class="nav-link" data-scroll-target="#from-attributions-to-motifs-tf-modisco"><span class="header-section-number">17.4</span> From Attributions to Motifs: TF-MoDISco</a>
  <ul class="collapse">
  <li><a href="#core-idea" id="toc-core-idea" class="nav-link" data-scroll-target="#core-idea"><span class="header-section-number">17.4.1</span> Core Idea</a></li>
  </ul></li>
  <li><a href="#interpreting-attention-and-long-range-context" id="toc-interpreting-attention-and-long-range-context" class="nav-link" data-scroll-target="#interpreting-attention-and-long-range-context"><span class="header-section-number">17.5</span> Interpreting Attention and Long-Range Context</a>
  <ul class="collapse">
  <li><a href="#genomic-language-models-and-operon-structure-glm" id="toc-genomic-language-models-and-operon-structure-glm" class="nav-link" data-scroll-target="#genomic-language-models-and-operon-structure-glm"><span class="header-section-number">17.5.1</span> Genomic Language Models and Operon Structure (gLM)</a></li>
  <li><a href="#distal-regulatory-elements-in-enformer-like-models" id="toc-distal-regulatory-elements-in-enformer-like-models" class="nav-link" data-scroll-target="#distal-regulatory-elements-in-enformer-like-models"><span class="header-section-number">17.5.2</span> Distal Regulatory Elements in Enformer-Like Models</a></li>
  </ul></li>
  <li><a href="#global-regulatory-vocabularies-sei-sequence-classes" id="toc-global-regulatory-vocabularies-sei-sequence-classes" class="nav-link" data-scroll-target="#global-regulatory-vocabularies-sei-sequence-classes"><span class="header-section-number">17.6</span> Global Regulatory Vocabularies: Sei Sequence Classes</a>
  <ul class="collapse">
  <li><a href="#the-sei-framework" id="toc-the-sei-framework" class="nav-link" data-scroll-target="#the-sei-framework"><span class="header-section-number">17.6.1</span> The Sei Framework</a></li>
  <li><a href="#interpretation-and-applications" id="toc-interpretation-and-applications" class="nav-link" data-scroll-target="#interpretation-and-applications"><span class="header-section-number">17.6.2</span> Interpretation and Applications</a></li>
  </ul></li>
  <li><a href="#case-study-from-base-pair-attributions-to-regulatory-grammar" id="toc-case-study-from-base-pair-attributions-to-regulatory-grammar" class="nav-link" data-scroll-target="#case-study-from-base-pair-attributions-to-regulatory-grammar"><span class="header-section-number">17.7</span> Case Study: From Base-Pair Attributions to Regulatory Grammar</a></li>
  <li><a href="#evaluating-interpretations-faithfulness-vs-plausibility" id="toc-evaluating-interpretations-faithfulness-vs-plausibility" class="nav-link" data-scroll-target="#evaluating-interpretations-faithfulness-vs-plausibility"><span class="header-section-number">17.8</span> Evaluating Interpretations: Faithfulness vs Plausibility</a></li>
  <li><a href="#a-practical-interpretability-toolbox-for-genomic-foundation-models" id="toc-a-practical-interpretability-toolbox-for-genomic-foundation-models" class="nav-link" data-scroll-target="#a-practical-interpretability-toolbox-for-genomic-foundation-models"><span class="header-section-number">17.9</span> A Practical Interpretability Toolbox for Genomic Foundation Models</a></li>
  <li><a href="#outlook-from-explanations-to-mechanistic-models" id="toc-outlook-from-explanations-to-mechanistic-models" class="nav-link" data-scroll-target="#outlook-from-explanations-to-mechanistic-models"><span class="header-section-number">17.10</span> Outlook: From Explanations to Mechanistic Models</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./p5-ch15-eval.html">Part V: Reliability &amp; Interpretation</a></li><li class="breadcrumb-item"><a href="./p5-ch17-interp.html"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Interpretability &amp; Mechanisms</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span id="sec-interp" class="quarto-section-identifier"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Interpretability &amp; Mechanisms</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="content-visible callout callout-style-default callout-warning callout-titled" data-when-profile="draft">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>TODO:</strong></p>
<ul>
<li>…</li>
<li>…</li>
</ul>
</div>
</div>
<section id="why-interpretability-matters-for-genomic-models" class="level2" data-number="17.1">
<h2 data-number="17.1" class="anchored" data-anchor-id="why-interpretability-matters-for-genomic-models"><span class="header-section-number">17.1</span> Why Interpretability Matters for Genomic Models</h2>
<p>Deep learning models in genomics increasingly operate as <strong>systems-level surrogates</strong> for biology: they predict chromatin features, gene expression, or variant effects directly from sequence. When such models drive mechanistic hypotheses or clinical decisions, <em>how</em> they make predictions becomes as important as <em>how well</em> they perform.</p>
<p>Interpretability in this context serves at least four roles:</p>
<ul>
<li><strong>Mechanistic insight</strong>
<ul>
<li>Extract sequence motifs (putative TF binding sites), regulatory grammars, and long-range interaction patterns directly from trained models.<br>
</li>
<li>Turn “black-box” predictions into candidate mechanisms that can be tested experimentally.</li>
</ul></li>
<li><strong>Model debugging and confounder detection</strong>
<ul>
<li>Reveal when models rely on artifacts (e.g., GC content, mappability, batch-specific motifs) instead of bona fide regulatory signals.<br>
</li>
<li>Complement <a href="p5-ch16-confound.html" class="quarto-xref"><span>Chapter 16</span></a>’s focus on data and evaluation confounders by interrogating <em>model internals</em>.</li>
</ul></li>
<li><strong>Clinical and translational trust</strong>
<ul>
<li>Support variant interpretation workflows by explaining why specific rare or de novo variants are predicted to be damaging.<br>
</li>
<li>Provide interpretable axes of variation (e.g., motif disruptions, regulatory “sequence classes”) that can be combined with orthogonal evidence.</li>
</ul></li>
<li><strong>Scientific communication</strong>
<ul>
<li>Condense high-dimensional latent representations into human-readable abstractions—motifs, regulatory classes, or interaction graphs—that can be shared across labs and applications.</li>
</ul></li>
</ul>
<p>This chapter surveys the main interpretability tools developed for genomic models, from convolutional filters and saliency maps to global regulatory vocabularies and attention patterns in genomic language models (gLMs) and transformer-based regulatory models. Throughout, the emphasis is on <strong>mechanistic</strong> interpretability: moving from “what correlates with the prediction?” to “what regulatory hypothesis does the model imply?”</p>
<hr>
</section>
<section id="interpreting-convolutional-filters-as-motifs" class="level2" data-number="17.2">
<h2 data-number="17.2" class="anchored" data-anchor-id="interpreting-convolutional-filters-as-motifs"><span class="header-section-number">17.2</span> Interpreting Convolutional Filters as Motifs</h2>
<p>Convolutional neural networks (CNNs) remain a workhorse for modeling cis-regulatory sequence (Chapters 5–7). In many of these models, <strong>first-layer convolutional filters</strong> act as <em>motif detectors</em>:</p>
<ul>
<li>A filter slides along the one-hot encoded sequence (<a href="p3-ch08-tokens.html" class="quarto-xref"><span>Chapter 8</span></a>).<br>
</li>
<li>At each position, it computes a dot product between its weights and the local sequence window.<br>
</li>
<li>High activation indicates that the subsequence closely matches the filter’s preferred pattern.</li>
</ul>
<section id="from-filters-to-motif-logos" class="level3" data-number="17.2.1">
<h3 data-number="17.2.1" class="anchored" data-anchor-id="from-filters-to-motif-logos"><span class="header-section-number">17.2.1</span> From Filters to Motif Logos</h3>
<p>A common workflow to interpret filters:</p>
<ol type="1">
<li><strong>Collect high-activation instances</strong>
<ul>
<li>Run the trained model on a large sequence set (e.g., training data or genome tiles).<br>
</li>
<li>For each filter, record positions where its activation exceeds a threshold.</li>
</ul></li>
<li><strong>Extract and align subsequences</strong>
<ul>
<li>Pull out fixed-length windows around those positions.<br>
</li>
<li>Align them and compute base frequencies at each position.</li>
</ul></li>
<li><strong>Build a position weight matrix (PWM)</strong>
<ul>
<li>Convert base frequencies to log-odds scores relative to a background distribution.<br>
</li>
<li>Visualize as a sequence logo.</li>
</ul></li>
<li><strong>Match to known motif databases</strong>
<ul>
<li>Compare PWMs to JASPAR or HOCOMOCO TF motif libraries using similarity scores.<br>
</li>
<li>Annotate filters with candidate TF identities (“this filter resembles CTCF”).</li>
</ul></li>
</ol>
<p>This procedure has been applied to models like DeepSEA and its successors to demonstrate that early layers learn motifs for canonical TFs and chromatin-associated patterns, validating that models are discovering biologically meaningful sequence features rather than arbitrary patterns.</p>
</section>
<section id="beyond-first-layer-filters" class="level3" data-number="17.2.2">
<h3 data-number="17.2.2" class="anchored" data-anchor-id="beyond-first-layer-filters"><span class="header-section-number">17.2.2</span> Beyond First-Layer Filters</h3>
<p>Deeper convolutional layers aggregate lower-level motifs:</p>
<ul>
<li><strong>Combinatorial motifs</strong>: Filters that respond to pairs or clusters of TF motifs.<br>
</li>
<li><strong>Grammar patterns</strong>: Distance or orientation constraints (e.g., “ETS motif ~10 bp upstream of GATA motif”).<br>
</li>
<li><strong>Contextual preferences</strong>: Filters that fire only in particular GC contexts or nucleosome positioning patterns.</li>
</ul>
<p>However, directly interpreting deeper layers becomes challenging because receptive fields expand and nonlinearities accumulate. This motivates <strong>attribution-based</strong> approaches that connect predictions back to individual bases.</p>
<hr>
</section>
</section>
<section id="attribution-methods-connecting-bases-to-predictions" class="level2" data-number="17.3">
<h2 data-number="17.3" class="anchored" data-anchor-id="attribution-methods-connecting-bases-to-predictions"><span class="header-section-number">17.3</span> Attribution Methods: Connecting Bases to Predictions</h2>
<p>Attribution methods assign an “importance score” to each input base (or k-mer), reflecting how much it contributes to a prediction for a specific task and sequence.</p>
<p>Let $ f(x) $ be a model predicting some output (e.g., chromatin accessibility, gene expression, or variant effect) from sequence $ x $. Attribution methods estimate the contribution of each base $ x_i $ to $ f(x) $, often for a specific output neuron (e.g., a particular cell type).</p>
<section id="in-silico-mutagenesis-ism" class="level3" data-number="17.3.1">
<h3 data-number="17.3.1" class="anchored" data-anchor-id="in-silico-mutagenesis-ism"><span class="header-section-number">17.3.1</span> In Silico Mutagenesis (ISM)</h3>
<p><strong>In silico mutagenesis</strong> is conceptually straightforward and model-agnostic:</p>
<ul>
<li>For each position $ i $ and base $ b $, create a mutated sequence $ x^{(i b)} $.<br>
</li>
<li>Compute the change in prediction<br>
<span class="math display">\[
\Delta f_{i,b} = f(x^{(i \rightarrow b)}) - f(x).
\]</span></li>
<li>Aggregate these changes (e.g., max across non-reference alleles) to obtain a per-base importance score.</li>
</ul>
<p>Variants:</p>
<ul>
<li><strong>Single-nucleotide ISM</strong>: Mutate each base individually; expensive but faithful.<br>
</li>
<li><strong>Saturation mutagenesis</strong>: Explore all possible oligos in a window to probe combinatorial effects and grammar.<br>
</li>
<li><strong>Variant-specific scoring</strong>: Evaluate $ f() - f() $ for a particular SNV or indel.</li>
</ul>
<p>Strengths:</p>
<ul>
<li>True “what-if” causal perturbations under the model.<br>
</li>
<li>Works for any differentiable or non-differentiable model (including ensembles and post-processed scores).</li>
</ul>
<p>Limitations:</p>
<ul>
<li>Computationally expensive: $ O(L ||) $ forward passes for sequence length $ L $ and alphabet size $ || $.<br>
</li>
<li>Captures local effects; may miss distributed interactions if not designed carefully.</li>
</ul>
</section>
<section id="gradient-based-methods" class="level3" data-number="17.3.2">
<h3 data-number="17.3.2" class="anchored" data-anchor-id="gradient-based-methods"><span class="header-section-number">17.3.2</span> Gradient-Based Methods</h3>
<p>Gradient-based methods approximate “how much would the prediction change if we nudged this base?” via backpropagation.</p>
<section id="vanilla-gradient-saliency" class="level4" data-number="17.3.2.1">
<h4 data-number="17.3.2.1" class="anchored" data-anchor-id="vanilla-gradient-saliency"><span class="header-section-number">17.3.2.1</span> Vanilla Gradient / Saliency</h4>
<p>Compute the gradient of the output with respect to the input:</p>
<p><span class="math display">\[
s_i = \frac{\partial f(x)}{\partial x_i}.
\]</span></p>
<p>With one-hot encoding, this gradient can be interpreted as the sensitivity to changing the nucleotide at position $ i $. A common variant multiplies the gradient by the input (“gradient × input”).</p>
<p>Pros:</p>
<ul>
<li>Requires a single backward pass per sequence.<br>
</li>
<li>Easy to implement and integrate into training workflows.</li>
</ul>
<p>Cons:</p>
<ul>
<li>Susceptible to gradient saturation (zero gradients in regions where the model is already confident).<br>
</li>
<li>Noisy saliency maps often require smoothing or aggregation across multiple noisy inputs.</li>
</ul>
</section>
<section id="deeplift" class="level4" data-number="17.3.2.2">
<h4 data-number="17.3.2.2" class="anchored" data-anchor-id="deeplift"><span class="header-section-number">17.3.2.2</span> DeepLIFT</h4>
<p><strong>DeepLIFT</strong> (Deep Learning Important FeaTures) compares neuron activations between an input and a <em>reference</em> (or baseline) sequence, distributing differences back to inputs using layer-wise rules rather than raw gradients. It aims to:</p>
<ul>
<li>Avoid gradient saturation.<br>
</li>
<li>Enforce a consistency constraint: the sum of input contributions matches the difference in output between input and reference.</li>
</ul>
<p>DeepLIFT has been widely used for genomic models, particularly in conjunction with TF-MoDISco (next section), where its base-level importance scores serve as inputs for motif discovery.</p>
</section>
<section id="integrated-gradients-ig" class="level4" data-number="17.3.2.3">
<h4 data-number="17.3.2.3" class="anchored" data-anchor-id="integrated-gradients-ig"><span class="header-section-number">17.3.2.3</span> Integrated Gradients (IG)</h4>
<p><strong>Integrated Gradients</strong> compute the path integral of gradients along a linear interpolation from a reference $ x’ $ to the input $ x $:</p>
<p><span class="math display">\[
\text{IG}_i(x) = (x_i - x'_i) \int_{\alpha=0}^1 \frac{\partial f\left(x' + \alpha(x - x')\right)}{\partial x_i} d\alpha.
\]</span></p>
<p>In practice, this integral is approximated via a Riemann sum over discrete steps. IG satisfies desirable axioms (e.g., sensitivity, implementation invariance) and tends to be less noisy than raw gradients.</p>
<p>Key design considerations for all gradient-based methods:</p>
<ul>
<li><strong>Choice of reference</strong>:
<ul>
<li>Random genomic background, dinucleotide-shuffled sequence, or an “average” non-functional sequence.<br>
</li>
<li>Different references emphasize different aspects of the signal.</li>
</ul></li>
<li><strong>Output selection</strong>:
<ul>
<li>Single-task models: directly attribute the scalar output.<br>
</li>
<li>Multi-task models: choose a specific track (e.g., H3K27ac in one cell type) or aggregate across tasks.</li>
</ul></li>
<li><strong>Post-processing</strong>:
<ul>
<li>Smooth along the sequence (e.g., average in sliding windows).<br>
</li>
<li>Aggregate over channels or strands.</li>
</ul></li>
</ul>
<hr>
</section>
</section>
</section>
<section id="from-attributions-to-motifs-tf-modisco" class="level2" data-number="17.4">
<h2 data-number="17.4" class="anchored" data-anchor-id="from-attributions-to-motifs-tf-modisco"><span class="header-section-number">17.4</span> From Attributions to Motifs: TF-MoDISco</h2>
<p>Attribution maps highlight <em>where</em> the model focuses, but they do not automatically yield <strong>consistent motifs</strong> or <strong>regulatory grammars</strong>. TF-MoDISco (Transcription Factor Motif Discovery from Importance Scores) was developed to bridge this gap.</p>
<section id="core-idea" class="level3" data-number="17.4.1">
<h3 data-number="17.4.1" class="anchored" data-anchor-id="core-idea"><span class="header-section-number">17.4.1</span> Core Idea</h3>
<p>Rather than performing motif discovery on raw sequences, TF-MoDISco operates on <strong>base-level importance scores</strong>:</p>
<ol type="1">
<li><strong>Compute importance scores</strong>
<ul>
<li>Use DeepLIFT, ISM, IG, or similar methods on many sequences.<br>
</li>
<li>Obtain an importance score for each base and strand.</li>
</ul></li>
<li><strong>Extract “seqlets”</strong>
<ul>
<li>Identify local windows where the <em>total</em> importance exceeds a threshold.<br>
</li>
<li>Treat each window (seqlet) as a candidate motif instance.</li>
</ul></li>
<li><strong>Cluster seqlets</strong>
<ul>
<li>Compare seqlets using similarity metrics that consider both sequence and importance scores.<br>
</li>
<li>Cluster into groups corresponding to putative motifs.</li>
</ul></li>
<li><strong>Build consolidated motifs</strong>
<ul>
<li>Align seqlets within each cluster.<br>
</li>
<li>Construct PWMs and importance-weighted logos.<br>
</li>
<li>Optionally match to known TF motifs.</li>
</ul></li>
<li><strong>Report motif instances and grammar</strong>
<ul>
<li>Map motifs back onto the genome.<br>
</li>
<li>Analyze co-occurrence, spacing, and orientation rules.</li>
</ul></li>
</ol>
<p>When applied to models like BPNet, TF-MoDISco has recovered known TF motifs, discovered novel variants, and revealed grammars (e.g., directional spacing constraints) that can be validated with synthetic reporter assays.</p>
<p>In the context of genomic foundation models, an analogous workflow can be applied:</p>
<ul>
<li>Use a GFM or transformer-based model to produce base-level attributions for a specific downstream task (e.g., chromatin accessibility).<br>
</li>
<li>Run TF-MoDISco to extract a <strong>task-specific motif vocabulary</strong>.<br>
</li>
<li>Analyze how motif usage changes across cell types, conditions, or species.</li>
</ul>
<hr>
</section>
</section>
<section id="interpreting-attention-and-long-range-context" class="level2" data-number="17.5">
<h2 data-number="17.5" class="anchored" data-anchor-id="interpreting-attention-and-long-range-context"><span class="header-section-number">17.5</span> Interpreting Attention and Long-Range Context</h2>
<p>Transformer-based models (Chapters 8–11) use <strong>self-attention</strong> to mix information across long genomic contexts, enabling them to capture distal regulatory interactions and genomic organization. Interpretability here often centers on <strong>attention patterns</strong> and <strong>long-range attribution</strong>.</p>
<section id="genomic-language-models-and-operon-structure-glm" class="level3" data-number="17.5.1">
<h3 data-number="17.5.1" class="anchored" data-anchor-id="genomic-language-models-and-operon-structure-glm"><span class="header-section-number">17.5.1</span> Genomic Language Models and Operon Structure (gLM)</h3>
<p>Genomic language models (gLMs) treat genes or genomic tokens as a sequence and train transformers to predict masked tokens, analogous to protein or text LMs. Work on gLMs trained on millions of metagenomic scaffolds shows that these models learn non-trivial genomic structure:</p>
<ul>
<li><strong>Attention heads mark operons and co-regulated modules</strong>
<ul>
<li>Certain heads specialize in connecting genes that are part of the same operon or functional module.<br>
</li>
<li>Attention maps reveal networks of co-regulated genes, often aligning with known operon boundaries.</li>
</ul></li>
<li><strong>Functional semantics and taxonomic signals</strong>
<ul>
<li>Latent representations cluster by enzymatic function and gene ontology.<br>
</li>
<li>Attention patterns can separate clades and capture clade-specific gene neighborhoods.</li>
</ul></li>
<li><strong>Mechanistic interpretation</strong>
<ul>
<li>These patterns suggest the model has inferred a “syntax” of gene neighborhoods: which genes tend to co-occur and in what order, conditioned on phylogenetic context.</li>
</ul></li>
</ul>
<p>While attention is not universally a faithful explanation of model decisions, attention analysis in gLM reveals <strong>emergent mechanistic structure</strong> that is consistent with biological organization.</p>
</section>
<section id="distal-regulatory-elements-in-enformer-like-models" class="level3" data-number="17.5.2">
<h3 data-number="17.5.2" class="anchored" data-anchor-id="distal-regulatory-elements-in-enformer-like-models"><span class="header-section-number">17.5.2</span> Distal Regulatory Elements in Enformer-Like Models</h3>
<p>Enformer and related models predict chromatin features and gene expression from large genomic windows (e.g., 100 kb+) by combining convolutional layers with transformer blocks.</p>
<p>Key interpretability questions:</p>
<ul>
<li>Which distal enhancers drive the predicted expression at a given transcription start site (TSS)?<br>
</li>
<li>How do variants in distal elements propagate to gene-level outputs?</li>
</ul>
<p>Interpretability strategies include:</p>
<ul>
<li><strong>Gradient-based attributions over long windows</strong>
<ul>
<li>Compute attributions of a gene’s expression output with respect to input bases across the entire window.<br>
</li>
<li>Visualize importance tracks to highlight putative enhancers and silencers.</li>
</ul></li>
<li><strong>Attention pattern analysis</strong>
<ul>
<li>Identify attention heads that consistently link distal positions to TSS regions.<br>
</li>
<li>Relate high-attention edges to Hi-C contact maps or chromatin interaction data.</li>
</ul></li>
<li><strong>In silico perturbation of regulatory elements</strong>
<ul>
<li>Delete or scramble candidate enhancers and recompute gene expression predictions.<br>
</li>
<li>Insert synthetic motifs or enhance motif scores to gauge dose–response relationships.</li>
</ul></li>
</ul>
<p>These analyses can reveal <em>candidate enhancer–promoter links</em> and TF motifs that the model deems critical for gene regulation, helping translate raw attention weights and attributions into mechanistic hypotheses.</p>
<hr>
</section>
</section>
<section id="global-regulatory-vocabularies-sei-sequence-classes" class="level2" data-number="17.6">
<h2 data-number="17.6" class="anchored" data-anchor-id="global-regulatory-vocabularies-sei-sequence-classes"><span class="header-section-number">17.6</span> Global Regulatory Vocabularies: Sei Sequence Classes</h2>
<p>Most motif-based interpretation operates at the <strong>local</strong> level. Sei takes a complementary <strong>global</strong> approach by learning a vocabulary of regulatory sequence <em>classes</em> that summarize a vast array of chromatin profiles.</p>
<section id="the-sei-framework" class="level3" data-number="17.6.1">
<h3 data-number="17.6.1" class="anchored" data-anchor-id="the-sei-framework"><span class="header-section-number">17.6.1</span> The Sei Framework</h3>
<p>Sei trains a deep sequence model to predict <strong>tens of thousands of chromatin profiles</strong> (TF binding, histone marks, accessibility) across many cell types directly from DNA sequence. The key interpretability step is to compress these thousands of outputs into <strong>a few dozen “sequence classes”</strong>, each representing a characteristic regulatory activity pattern:</p>
<ul>
<li>Promoter-like classes (e.g., H3K4me3-rich, TSS-proximal).<br>
</li>
<li>Enhancer-like classes (H3K27ac, H3K4me1).<br>
</li>
<li>Repressive classes (H3K27me3, H3K9me3).<br>
</li>
<li>Cell-type- or lineage-specific modules (e.g., neuronal, immune).</li>
</ul>
<p>Each input sequence (or variant) is assigned a score for each sequence class, effectively mapping it to a point in a <strong>low-dimensional “regulatory activity space”</strong>.</p>
</section>
<section id="interpretation-and-applications" class="level3" data-number="17.6.2">
<h3 data-number="17.6.2" class="anchored" data-anchor-id="interpretation-and-applications"><span class="header-section-number">17.6.2</span> Interpretation and Applications</h3>
<p>A regulatory vocabulary like Sei’s supports several interpretability goals:</p>
<ul>
<li><strong>Intermediate, human-interpretable features</strong>
<ul>
<li>Instead of raw high-dimensional outputs, one can reason in terms of “promoter-like,” “B-cell enhancer,” or “polycomb-repressed” scores.</li>
</ul></li>
<li><strong>Variant interpretation</strong>
<ul>
<li>Variants can be summarized by their shifts in sequence-class scores, yielding concise descriptions like “increases neuronal enhancer activity while decreasing repressive marks.”</li>
</ul></li>
<li><strong>Trait and disease enrichment</strong>
<ul>
<li>GWAS loci can be enriched for specific sequence classes, revealing tissues and regulatory programs most relevant to disease.</li>
</ul></li>
</ul>
<p>This notion of a <strong>regulatory vocabulary</strong> parallels word embeddings or topics in NLP and provides a bridge between highly multivariate model outputs and mechanistically interpretable axes of variation.</p>
<hr>
</section>
</section>
<section id="case-study-from-base-pair-attributions-to-regulatory-grammar" class="level2" data-number="17.7">
<h2 data-number="17.7" class="anchored" data-anchor-id="case-study-from-base-pair-attributions-to-regulatory-grammar"><span class="header-section-number">17.7</span> Case Study: From Base-Pair Attributions to Regulatory Grammar</h2>
<p>Putting the pieces together, a typical mechanistic interpretability pipeline for a CNN or transformer-based regulatory model might look like:</p>
<ol type="1">
<li><strong>Train a predictive model</strong>
<ul>
<li>For example, predict chromatin accessibility or TF ChIP-seq tracks from sequence.</li>
</ul></li>
<li><strong>Compute base-level attributions</strong>
<ul>
<li>Use DeepLIFT or IG for positive predictions in a target cell type.</li>
</ul></li>
<li><strong>Discover motifs with TF-MoDISco</strong>
<ul>
<li>Extract seqlets from high-attribution regions, cluster, and derive motifs.<br>
</li>
<li>Match motifs to known TFs and identify novel ones.</li>
</ul></li>
<li><strong>Infer grammar from motif instances</strong>
<ul>
<li>Analyze motif co-occurrence, spacing, and orientation in high-scoring sequences.<br>
</li>
<li>Use knock-in/knock-out <em>in silico</em> experiments to confirm dependencies (e.g., both motifs needed, order matters).</li>
</ul></li>
<li><strong>Relate motifs to sequence classes or attention patterns</strong>
<ul>
<li>Map motif-rich regions to Sei sequence classes or Enformer attributions.<br>
</li>
<li>Connect local motif grammar to global regulatory context (e.g., distal enhancer–promoter linkages, cell-type specificity).</li>
</ul></li>
<li><strong>Validate with experiments or external datasets</strong>
<ul>
<li>Check whether motif disruptions align with reporter assay effects or allelic imbalance.<br>
</li>
<li>Compare inferred enhancer–promoter links to Hi-C or CRISPR perturbation screens.</li>
</ul></li>
</ol>
<p>This integrated approach moves beyond “pretty saliency maps” toward <strong>testable hypotheses</strong> about regulatory logic.</p>
<hr>
</section>
<section id="evaluating-interpretations-faithfulness-vs-plausibility" class="level2" data-number="17.8">
<h2 data-number="17.8" class="anchored" data-anchor-id="evaluating-interpretations-faithfulness-vs-plausibility"><span class="header-section-number">17.8</span> Evaluating Interpretations: Faithfulness vs Plausibility</h2>
<p>Not all explanations are equally trustworthy. Effective interpretability work must grapple with the distinction between:</p>
<ul>
<li><strong>Plausibility</strong>: Does the explanation “look” biological (e.g., known motifs, enhancer marks)?<br>
</li>
<li><strong>Faithfulness</strong>: Does the explanation accurately reflect the internal computation of the model?</li>
</ul>
<p>Potential pitfalls:</p>
<ul>
<li><strong>Attention as explanation</strong>
<ul>
<li>High attention weights need not correspond to large changes in output; they may reflect information routing rather than causal influence.<br>
</li>
<li>Combining attention with attribution or perturbation analyses yields more reliable insights.</li>
</ul></li>
<li><strong>Attribution noise and saturation</strong>
<ul>
<li>Gradient-based methods can produce noisy maps or miss important features in saturated regions.<br>
</li>
<li>Use multiple methods (ISM, DeepLIFT, IG) and check for consistency.</li>
</ul></li>
<li><strong>Shortcut features</strong>
<ul>
<li>Models may rely on dataset-specific artifacts (e.g., barcode k-mers, GC content) that produce clean motifs but are not mechanistically meaningful.</li>
</ul></li>
</ul>
<p>Recommended practices:</p>
<ul>
<li><strong>Sanity checks</strong>
<ul>
<li>Randomize model weights: attributions should degrade to noise.<br>
</li>
<li>Randomize labels: derived motifs should disappear or lose predictive power.</li>
</ul></li>
<li><strong>Counterfactual tests</strong>
<ul>
<li>Delete or scramble high-attribution regions and confirm that predictions drop accordingly.<br>
</li>
<li>Insert discovered motifs into neutral backgrounds to test gain-of-function effects.</li>
</ul></li>
<li><strong>Benchmarking interpretability methods</strong>
<ul>
<li>Use synthetic datasets with known ground-truth grammar.<br>
</li>
<li>Compare methods on their ability to recover planted motifs and interactions.</li>
</ul></li>
</ul>
<hr>
</section>
<section id="a-practical-interpretability-toolbox-for-genomic-foundation-models" class="level2" data-number="17.9">
<h2 data-number="17.9" class="anchored" data-anchor-id="a-practical-interpretability-toolbox-for-genomic-foundation-models"><span class="header-section-number">17.9</span> A Practical Interpretability Toolbox for Genomic Foundation Models</h2>
<p>For practitioners working with genomic foundation models (GFMs) and their fine-tuned derivatives, a practical toolbox might include:</p>
<ol type="1">
<li><strong>Local effect estimation</strong>
<ul>
<li>For variant effect prediction: use <strong>ref/alt scoring</strong> and small-window ISM around variants.<br>
</li>
<li>Aggregate per-base attributions into per-variant or per-motif scores.</li>
</ul></li>
<li><strong>Motif and grammar discovery</strong>
<ul>
<li>Compute base-level attributions for high-confidence predictions.<br>
</li>
<li>Run TF-MoDISco or similar algorithms to build a motif vocabulary.<br>
</li>
<li>Analyze motif grammars across tasks (e.g., multiple cell types or assays).</li>
</ul></li>
<li><strong>Global context visualization</strong>
<ul>
<li>For transformer-based GFMs: inspect attention patterns to identify heads that track operons, gene neighborhoods, or enhancer–promoter loops.<br>
</li>
<li>For models like Enformer: combine long-range attributions with contact maps to hypothesize regulatory architectures.</li>
</ul></li>
<li><strong>Regulatory vocabularies and embeddings</strong>
<ul>
<li>Use frameworks like Sei to project sequences into a low-dimensional regulatory activity space.<br>
</li>
<li>Cluster variants, enhancers, or genomic regions by their sequence-class profiles to reveal shared regulatory programs.</li>
</ul></li>
<li><strong>Model and dataset auditing</strong>
<ul>
<li>Use interpretability tools to identify reliance on confounded or undesirable features.<br>
</li>
<li>Cross-reference with <a href="p5-ch16-confound.html" class="quarto-xref"><span>Chapter 16</span></a>’s confounder taxonomy (ancestry stratification, batch effects) to design deconfounded training and evaluation.</li>
</ul></li>
<li><strong>Human-in-the-loop analysis</strong>
<ul>
<li>Integrate motif and sequence-class outputs into visualization tools (e.g., genome browsers with attribution tracks, motif tracks, and class scores).<br>
</li>
<li>Enable domain experts to iteratively refine hypotheses.</li>
</ul></li>
</ol>
<hr>
</section>
<section id="outlook-from-explanations-to-mechanistic-models" class="level2" data-number="17.10">
<h2 data-number="17.10" class="anchored" data-anchor-id="outlook-from-explanations-to-mechanistic-models"><span class="header-section-number">17.10</span> Outlook: From Explanations to Mechanistic Models</h2>
<p>Interpretability in genomic deep learning is evolving from <strong>post hoc explanation</strong> toward <strong>model-assisted mechanistic discovery</strong>:</p>
<ul>
<li>Foundation models provide rich latent spaces and long-range context.<br>
</li>
<li>Attribution and motif discovery tools translate those representations into candidate regulatory grammars.<br>
</li>
<li>Global vocabularies like Sei’s sequence classes offer interpretable axes spanning thousands of assays.<br>
</li>
<li>Attention analysis in genomic language models reveals emergent gene-level organization, hinting at scalable ways to capture systems-level biology.</li>
</ul>
<p>The next frontier is to <strong>close the loop</strong>:</p>
<ul>
<li>Use insights from interpretability (motifs, grammars, sequence classes) to design better architectures and training objectives.<br>
</li>
<li>Feed experimentally validated grammars back into models as inductive biases.<br>
</li>
<li>Develop evaluation frameworks where success is measured not only by predictive accuracy but also by <strong>mechanistic fidelity</strong>—how well model-derived hypotheses align with the causal structure of regulatory biology.</li>
</ul>
<p>In this sense, interpretability is not just a diagnostic for black-box models. It is a central tool for turning genomic foundation models into <strong>engines of biological discovery</strong>, capable of bridging the gap between sequence-level predictions and the mechanistic understanding that underpins robust clinical translation.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./p5-ch16-confound.html" class="pagination-link" aria-label="Confounders in Model Training">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Confounders in Model Training</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./p6-ch18-clinical.html" class="pagination-link" aria-label="Clinical Risk Prediction">
        <span class="nav-page-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Clinical Risk Prediction</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Copyright 2025, Josh Meehl</p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>