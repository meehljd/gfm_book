<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>21&nbsp; Evaluation Principles – Genomic Foundation Models</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./p5-ch22-confounding.html" rel="next">
<link href="./p5-ch20-benchmarks.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-b758ccaa5987ceb1b75504551e579abf.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-a1553387a0f784068632030e9fbb8a3c.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark-d1e9b63c6b6094879b9f94a7628e3370.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="site_libs/bootstrap/bootstrap-a1553387a0f784068632030e9fbb8a3c.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar floating quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./p5--eval-interp.html">Part V: Evaluation and Trust</a></li><li class="breadcrumb-item"><a href="./p5-ch21-eval.html"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Evaluation Principles</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Genomic Foundation Models</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./p1--foundations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Part I: Data Foundations</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p1-ch01-ngs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">From Reads to Variants</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p1-ch02-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">The Data Landscape</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p1-ch03-gwas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">GWAS and Polygenic Scores</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p1-ch04-vep-classical.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Classical Variant Prediction</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./p2--principles.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Part II: Sequence Architectures</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p2-ch05-representations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Tokens and Embeddings</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p2-ch06-cnn.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Convolutional Networks</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p2-ch07-attention.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Transformers and Attention</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p2-ch08-pretraining.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Pretraining Strategies</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p2-ch09-transfer.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Transfer and Adaptation</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./p3--architectures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Part III: Foundation Model Families</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p3-ch10-fm-principles.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Foundation Model Paradigm</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p3-ch11-dna-lm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">DNA Language Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p3-ch12-protein-lm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Protein Language Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p3-ch13-regulatory.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Regulatory Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p3-ch14-vep-fm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Variant Effect Prediction</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./p4--multi-scale.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Part IV: Systems and Scale</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p4-ch15-rna.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">RNA Structure and Function</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p4-ch16-single-cell.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Single-Cell Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p4-ch17-3d-genome.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">3D Genome Organization</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p4-ch18-networks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Graph and Network Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p4-ch19-multi-omics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Multi-Omics Integration</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./p5--eval-interp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Part V: Evaluation and Trust</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p5-ch20-benchmarks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Benchmarks</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p5-ch21-eval.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Evaluation Principles</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p5-ch22-confounding.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Confounders and Leakage</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p5-ch23-uncertainty.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Uncertainty Quantification</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p5-ch24-interpretability.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Interpretability</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./p6--translation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Part VI: Clinical Translation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p6-ch25-clinical-risk.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Clinical Risk Prediction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p6-ch26-rare-disease.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Rare Disease Diagnosis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p6-ch27-drug-discovery.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Drug Discovery</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p6-ch28-design.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Sequence Design</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p6-ch29-future.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Ethical and Frontiers</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app-a-dl.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Deep Learning Primer</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app-b-compute.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Deployment and Compute</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app-c-data-curation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Data Curation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app-d-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">Model Reference</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app-e-resources.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">E</span>&nbsp; <span class="chapter-title">Resources</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app-f-glossary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">F</span>&nbsp; <span class="chapter-title">Glossary</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#why-random-splits-fail" id="toc-why-random-splits-fail" class="nav-link active" data-scroll-target="#why-random-splits-fail"><span class="header-section-number">21.1</span> Why Random Splits Fail</a></li>
  <li><a href="#homology-aware-splitting" id="toc-homology-aware-splitting" class="nav-link" data-scroll-target="#homology-aware-splitting"><span class="header-section-number">21.2</span> Homology-Aware Splitting</a>
  <ul class="collapse">
  <li><a href="#clustering-tools-and-workflows" id="toc-clustering-tools-and-workflows" class="nav-link" data-scroll-target="#clustering-tools-and-workflows"><span class="header-section-number">21.2.1</span> Clustering Tools and Workflows</a></li>
  <li><a href="#practical-considerations" id="toc-practical-considerations" class="nav-link" data-scroll-target="#practical-considerations"><span class="header-section-number">21.2.2</span> Practical Considerations</a></li>
  </ul></li>
  <li><a href="#splitting-by-biological-axis" id="toc-splitting-by-biological-axis" class="nav-link" data-scroll-target="#splitting-by-biological-axis"><span class="header-section-number">21.3</span> Splitting by Biological Axis</a>
  <ul class="collapse">
  <li><a href="#splitting-by-individual" id="toc-splitting-by-individual" class="nav-link" data-scroll-target="#splitting-by-individual"><span class="header-section-number">21.3.1</span> Splitting by Individual</a></li>
  <li><a href="#splitting-by-genomic-region" id="toc-splitting-by-genomic-region" class="nav-link" data-scroll-target="#splitting-by-genomic-region"><span class="header-section-number">21.3.2</span> Splitting by Genomic Region</a></li>
  <li><a href="#splitting-by-gene-or-protein-family" id="toc-splitting-by-gene-or-protein-family" class="nav-link" data-scroll-target="#splitting-by-gene-or-protein-family"><span class="header-section-number">21.3.3</span> Splitting by Gene or Protein Family</a></li>
  <li><a href="#splitting-by-experimental-context" id="toc-splitting-by-experimental-context" class="nav-link" data-scroll-target="#splitting-by-experimental-context"><span class="header-section-number">21.3.4</span> Splitting by Experimental Context</a></li>
  <li><a href="#splitting-by-ancestry" id="toc-splitting-by-ancestry" class="nav-link" data-scroll-target="#splitting-by-ancestry"><span class="header-section-number">21.3.5</span> Splitting by Ancestry</a></li>
  <li><a href="#splitting-by-time" id="toc-splitting-by-time" class="nav-link" data-scroll-target="#splitting-by-time"><span class="header-section-number">21.3.6</span> Splitting by Time</a></li>
  </ul></li>
  <li><a href="#leakage-taxonomy-and-detection" id="toc-leakage-taxonomy-and-detection" class="nav-link" data-scroll-target="#leakage-taxonomy-and-detection"><span class="header-section-number">21.4</span> Leakage Taxonomy and Detection</a>
  <ul class="collapse">
  <li><a href="#feature-leakage" id="toc-feature-leakage" class="nav-link" data-scroll-target="#feature-leakage"><span class="header-section-number">21.4.1</span> Feature Leakage</a></li>
  <li><a href="#label-leakage" id="toc-label-leakage" class="nav-link" data-scroll-target="#label-leakage"><span class="header-section-number">21.4.2</span> Label Leakage</a></li>
  <li><a href="#benchmark-leakage" id="toc-benchmark-leakage" class="nav-link" data-scroll-target="#benchmark-leakage"><span class="header-section-number">21.4.3</span> Benchmark Leakage</a></li>
  <li><a href="#detection-strategies" id="toc-detection-strategies" class="nav-link" data-scroll-target="#detection-strategies"><span class="header-section-number">21.4.4</span> Detection Strategies</a></li>
  </ul></li>
  <li><a href="#metrics-for-genomic-tasks" id="toc-metrics-for-genomic-tasks" class="nav-link" data-scroll-target="#metrics-for-genomic-tasks"><span class="header-section-number">21.5</span> Metrics for Genomic Tasks</a>
  <ul class="collapse">
  <li><a href="#discrimination-metrics" id="toc-discrimination-metrics" class="nav-link" data-scroll-target="#discrimination-metrics"><span class="header-section-number">21.5.1</span> Discrimination Metrics</a></li>
  <li><a href="#regression-and-correlation-metrics" id="toc-regression-and-correlation-metrics" class="nav-link" data-scroll-target="#regression-and-correlation-metrics"><span class="header-section-number">21.5.2</span> Regression and Correlation Metrics</a></li>
  <li><a href="#ranking-and-prioritization-metrics" id="toc-ranking-and-prioritization-metrics" class="nav-link" data-scroll-target="#ranking-and-prioritization-metrics"><span class="header-section-number">21.5.3</span> Ranking and Prioritization Metrics</a></li>
  <li><a href="#calibration-metrics" id="toc-calibration-metrics" class="nav-link" data-scroll-target="#calibration-metrics"><span class="header-section-number">21.5.4</span> Calibration Metrics</a></li>
  <li><a href="#clinical-utility-metrics" id="toc-clinical-utility-metrics" class="nav-link" data-scroll-target="#clinical-utility-metrics"><span class="header-section-number">21.5.5</span> Clinical Utility Metrics</a></li>
  </ul></li>
  <li><a href="#baseline-selection" id="toc-baseline-selection" class="nav-link" data-scroll-target="#baseline-selection"><span class="header-section-number">21.6</span> Baseline Selection</a>
  <ul class="collapse">
  <li><a href="#strong-baselines-not-straw-men" id="toc-strong-baselines-not-straw-men" class="nav-link" data-scroll-target="#strong-baselines-not-straw-men"><span class="header-section-number">21.6.1</span> Strong Baselines, Not Straw Men</a></li>
  <li><a href="#historical-baselines-and-progress-tracking" id="toc-historical-baselines-and-progress-tracking" class="nav-link" data-scroll-target="#historical-baselines-and-progress-tracking"><span class="header-section-number">21.6.2</span> Historical Baselines and Progress Tracking</a></li>
  <li><a href="#non-deep-learning-baselines" id="toc-non-deep-learning-baselines" class="nav-link" data-scroll-target="#non-deep-learning-baselines"><span class="header-section-number">21.6.3</span> Non-Deep-Learning Baselines</a></li>
  </ul></li>
  <li><a href="#ablation-studies" id="toc-ablation-studies" class="nav-link" data-scroll-target="#ablation-studies"><span class="header-section-number">21.7</span> Ablation Studies</a>
  <ul class="collapse">
  <li><a href="#component-isolation" id="toc-component-isolation" class="nav-link" data-scroll-target="#component-isolation"><span class="header-section-number">21.7.1</span> Component Isolation</a></li>
  <li><a href="#hyperparameter-sensitivity" id="toc-hyperparameter-sensitivity" class="nav-link" data-scroll-target="#hyperparameter-sensitivity"><span class="header-section-number">21.7.2</span> Hyperparameter Sensitivity</a></li>
  <li><a href="#architecture-search-confounds" id="toc-architecture-search-confounds" class="nav-link" data-scroll-target="#architecture-search-confounds"><span class="header-section-number">21.7.3</span> Architecture Search Confounds</a></li>
  <li><a href="#reporting-standards" id="toc-reporting-standards" class="nav-link" data-scroll-target="#reporting-standards"><span class="header-section-number">21.7.4</span> Reporting Standards</a></li>
  </ul></li>
  <li><a href="#statistical-rigor" id="toc-statistical-rigor" class="nav-link" data-scroll-target="#statistical-rigor"><span class="header-section-number">21.8</span> Statistical Rigor</a>
  <ul class="collapse">
  <li><a href="#significance-testing" id="toc-significance-testing" class="nav-link" data-scroll-target="#significance-testing"><span class="header-section-number">21.8.1</span> Significance Testing</a></li>
  <li><a href="#effect-sizes" id="toc-effect-sizes" class="nav-link" data-scroll-target="#effect-sizes"><span class="header-section-number">21.8.2</span> Effect Sizes</a></li>
  <li><a href="#confidence-intervals-on-metrics" id="toc-confidence-intervals-on-metrics" class="nav-link" data-scroll-target="#confidence-intervals-on-metrics"><span class="header-section-number">21.8.3</span> Confidence Intervals on Metrics</a></li>
  <li><a href="#variance-across-random-seeds" id="toc-variance-across-random-seeds" class="nav-link" data-scroll-target="#variance-across-random-seeds"><span class="header-section-number">21.8.4</span> Variance Across Random Seeds</a></li>
  </ul></li>
  <li><a href="#evaluating-foundation-models" id="toc-evaluating-foundation-models" class="nav-link" data-scroll-target="#evaluating-foundation-models"><span class="header-section-number">21.9</span> Evaluating Foundation Models</a>
  <ul class="collapse">
  <li><a href="#zero-shot-evaluation" id="toc-zero-shot-evaluation" class="nav-link" data-scroll-target="#zero-shot-evaluation"><span class="header-section-number">21.9.1</span> Zero-Shot Evaluation</a></li>
  <li><a href="#linear-probing" id="toc-linear-probing" class="nav-link" data-scroll-target="#linear-probing"><span class="header-section-number">21.9.2</span> Linear Probing</a></li>
  <li><a href="#fine-tuning-evaluation" id="toc-fine-tuning-evaluation" class="nav-link" data-scroll-target="#fine-tuning-evaluation"><span class="header-section-number">21.9.3</span> Fine-Tuning Evaluation</a></li>
  <li><a href="#transfer-across-tasks" id="toc-transfer-across-tasks" class="nav-link" data-scroll-target="#transfer-across-tasks"><span class="header-section-number">21.9.4</span> Transfer Across Tasks</a></li>
  </ul></li>
  <li><a href="#calibration-essentials" id="toc-calibration-essentials" class="nav-link" data-scroll-target="#calibration-essentials"><span class="header-section-number">21.10</span> Calibration Essentials</a>
  <ul class="collapse">
  <li><a href="#assessing-calibration" id="toc-assessing-calibration" class="nav-link" data-scroll-target="#assessing-calibration"><span class="header-section-number">21.10.1</span> Assessing Calibration</a></li>
  <li><a href="#recalibration-methods" id="toc-recalibration-methods" class="nav-link" data-scroll-target="#recalibration-methods"><span class="header-section-number">21.10.2</span> Recalibration Methods</a></li>
  </ul></li>
  <li><a href="#putting-it-all-together" id="toc-putting-it-all-together" class="nav-link" data-scroll-target="#putting-it-all-together"><span class="header-section-number">21.11</span> Putting It All Together</a></li>
  <li><a href="#looking-forward" id="toc-looking-forward" class="nav-link" data-scroll-target="#looking-forward"><span class="header-section-number">21.12</span> Looking Forward</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./p5--eval-interp.html">Part V: Evaluation and Trust</a></li><li class="breadcrumb-item"><a href="./p5-ch21-eval.html"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Evaluation Principles</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span id="sec-evaluation" class="quarto-section-identifier"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Evaluation Principles</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>A model that achieves state-of-the-art performance on a chromatin benchmark may fail catastrophically on real clinical variants. A foundation model that improves AUROC from 0.89 to 0.90 may have learned nothing about biology and everything about data leakage. A polygenic score that predicts disease with apparent precision in British biobank participants may perform no better than random chance in African populations. The history of genomic machine learning is littered with models that worked brilliantly on paper and failed quietly in practice.</p>
<p>The fundamental problem is that genomic data makes it exceptionally easy to fool yourself. Sequences share evolutionary history. Variants cluster in families and populations. Experimental measurements carry batch effects invisible to the untrained eye. Training labels often derive from the very databases that will be used for evaluation, creating circular validations that inflate performance without testing genuine predictive power. Random data splits that work perfectly well for natural images become actively misleading when applied to genomes, proteins, or variants. Every shortcut that simplifies evaluation in other domains creates an opportunity for false confidence in genomics.</p>
<p><a href="p5-ch20-benchmarks.html" class="quarto-xref"><span>Chapter 20</span></a> catalogs the benchmark landscape in detail, describing what tasks exist, how they are constructed, and what capabilities they probe. This chapter addresses the complementary question: how to use benchmarks appropriately to draw valid conclusions about model performance. The difference between a trustworthy evaluation and a misleading one often lies not in the choice of benchmark but in the details of how that benchmark is applied. Data splitting strategies, metric selection, baseline comparisons, ablation designs, and statistical testing collectively determine whether reported results mean anything at all.</p>
<p>The principles developed here apply across all the benchmark categories described in <a href="p5-ch20-benchmarks.html" class="quarto-xref"><span>Chapter 20</span></a>, from chromatin state prediction to clinical variant classification. By this point in the book, we have encountered genomic models deployed at almost every scale: variant calling from NGS reads (<a href="p1-ch01-ngs.html" class="quarto-xref"><span>Chapter 1</span></a>), polygenic scores and GWAS (<a href="p1-ch03-gwas.html" class="quarto-xref"><span>Chapter 3</span></a>), classical deleteriousness predictors (<a href="p1-ch04-vep-classical.html" class="quarto-xref"><span>Chapter 4</span></a>), foundation model approaches to variant effects (<a href="p3-ch14-vep-fm.html" class="quarto-xref"><span>Chapter 14</span></a>), CNN-based regulatory models (<a href="p2-ch06-cnn.html" class="quarto-xref"><span>Chapter 6</span></a>), and genomic language models (<a href="p3-ch11-dna-lm.html" class="quarto-xref"><span>Chapter 11</span></a>, <a href="p3-ch10-fm-principles.html" class="quarto-xref"><span>Chapter 10</span></a>). Clinical risk prediction and rare disease diagnosis (<a href="p6-ch25-clinical-risk.html" class="quarto-xref"><span>Chapter 25</span></a>, <a href="p6-ch26-rare-disease.html" class="quarto-xref"><span>Chapter 26</span></a>) add still more evaluation considerations. What has been missing is a unified treatment of the question: what does it mean for a genomic model to work, and how do we know when it does?</p>
<section id="why-random-splits-fail" class="level2" data-number="21.1">
<h2 data-number="21.1" class="anchored" data-anchor-id="why-random-splits-fail"><span class="header-section-number">21.1</span> Why Random Splits Fail</h2>
<p>The standard machine learning recipe calls for randomly partitioning data into training, validation, and test sets. For image classification or sentiment analysis, this approach works well because individual examples are approximately independent. A photograph of a cat shares no special relationship with another photograph of a different cat beyond their common label. Random assignment ensures that training and test distributions match, and performance on the test set provides an unbiased estimate of performance on new examples from the same distribution.</p>
<p>Genomic data violates these assumptions at every level. Consider a protein dataset where the goal is to predict stability from sequence. Proteins in the same family share evolutionary history and often similar structures. If a training set includes beta-lactamase variants from <em>E. coli</em> and the test set includes beta-lactamase variants from <em>Klebsiella</em>, the model may appear to generalize to “new” proteins while actually recognizing sequence patterns it saw during training. The test performance reflects memorization of family-specific features rather than general principles of protein stability.</p>
<p>The problem compounds when sequence identity is high. Two proteins sharing 80% sequence identity will typically have similar structures and functions. A model trained on one and tested on the other is not really being tested on a novel example; it is being asked to interpolate within a region of sequence space it has already explored. Even at 30% sequence identity, the so-called “twilight zone” of homology detection, proteins often share structural and functional similarities that can be exploited by sufficiently powerful models.</p>
<p>Variant-level data presents analogous challenges. Variants within the same gene share genomic context, and variants affecting the same protein domain share structural environment. Variants from the same individual share haplotype background. Variants from the same population share allele frequency distributions shaped by demographic history. Each of these relationships creates opportunities for models to learn shortcuts that generalize within the training distribution but fail on genuinely novel examples.</p>
<p>The consequence is that random splits systematically overestimate generalization. A model that achieves 0.90 AUROC with random splitting might achieve only 0.75 AUROC when evaluated on truly held-out examples, with the gap reflecting how much the model learned about biology versus how much it learned about the structure of the training data. Recognizing this problem is the first step toward solving it.</p>
</section>
<section id="homology-aware-splitting" class="level2" data-number="21.2">
<h2 data-number="21.2" class="anchored" data-anchor-id="homology-aware-splitting"><span class="header-section-number">21.2</span> Homology-Aware Splitting</h2>
<p>The solution to homology-driven leakage is to explicitly account for sequence similarity when constructing data splits. Rather than random assignment, examples are clustered by sequence identity, and entire clusters are assigned to training, validation, or test sets. This ensures that no test example is “too similar” to any training example, forcing the model to demonstrate genuine generalization.</p>
<section id="clustering-tools-and-workflows" class="level3" data-number="21.2.1">
<h3 data-number="21.2.1" class="anchored" data-anchor-id="clustering-tools-and-workflows"><span class="header-section-number">21.2.1</span> Clustering Tools and Workflows</h3>
<p>Two tools dominate homology-aware splitting in practice. <strong>CD-HIT</strong> clusters sequences by greedy incremental clustering, assigning each sequence to an existing cluster if it exceeds a similarity threshold to the cluster representative, or creating a new cluster otherwise. The algorithm is fast and scales to millions of sequences. For proteins, a typical workflow clusters at 40% sequence identity for stringent splitting or 70% for moderate splitting. For nucleotide sequences, thresholds are typically higher (80-95%) due to different evolutionary rates.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cluster proteins at 40% identity</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="ex">cd-hit</span> <span class="at">-i</span> proteins.fasta <span class="at">-o</span> proteins_clustered <span class="at">-c</span> 0.4 <span class="at">-n</span> 2</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Cluster nucleotides at 90% identity  </span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="ex">cd-hit-est</span> <span class="at">-i</span> sequences.fasta <span class="at">-o</span> sequences_clustered <span class="at">-c</span> 0.9 <span class="at">-n</span> 8</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>MMseqs2</strong> offers faster clustering with similar sensitivity, becoming essential for large-scale analyses. The tool supports multiple clustering modes and can handle databases with hundreds of millions of sequences. For foundation model pretraining where deduplication affects billions of sequences, MMseqs2 is often the only practical option.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create database and cluster at 30% identity</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="ex">mmseqs</span> createdb proteins.fasta DB</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="ex">mmseqs</span> cluster DB DB_clu tmp <span class="at">--min-seq-id</span> 0.3</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="ex">mmseqs</span> createtsv DB DB DB_clu clusters.tsv</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>The choice of identity threshold involves trade-offs. Stricter thresholds (lower identity for proteins, higher for nucleotides) create harder generalization tests but may leave insufficient data for training if clusters are small. Permissive thresholds retain more training data but allow more leakage through homologous sequences. For protein function prediction, 30-40% identity thresholds are common; for variant effect prediction within genes, even stricter gene-family-level splits may be necessary.</p>
</section>
<section id="practical-considerations" class="level3" data-number="21.2.2">
<h3 data-number="21.2.2" class="anchored" data-anchor-id="practical-considerations"><span class="header-section-number">21.2.2</span> Practical Considerations</h3>
<p>Several subtleties affect the quality of homology-aware splits. <strong>Cluster size distribution</strong> matters: if one cluster contains half the data and is assigned to training, the remaining clusters may be too small or too biased to serve as representative test sets. Stratified sampling within clusters or careful balancing across splits can mitigate this issue.</p>
<p><strong>Transitive homology</strong> creates hidden relationships that pairwise clustering can miss. Protein A may share 35% identity with protein B, and protein B may share 35% identity with protein C, yet A and C share only 20% identity. If A is in training and C is in testing, B serves as an indirect bridge. Connected component analysis or multi-step clustering can address these transitive relationships, though at increased computational cost.</p>
<p><strong>Domain-level homology</strong> complicates whole-protein clustering. A multi-domain protein may share one domain with training proteins and another domain with test proteins. Whether this represents leakage depends on the prediction task: if predicting whole-protein function, shared domains matter; if predicting domain-specific properties, they matter more acutely. Domain-aware splitting assigns domains rather than whole proteins to clusters, though this requires domain annotation that may not always be available.</p>
<p>For genomic (non-protein) sequences, repeat elements and transposable elements create analogous challenges. A model trained to predict chromatin state may learn features of LINE elements that recur throughout the genome. Excluding repetitive regions from evaluation or explicitly accounting for repeat content can clarify what the model has actually learned about regulatory sequences versus repetitive element patterns.</p>
</section>
</section>
<section id="splitting-by-biological-axis" class="level2" data-number="21.3">
<h2 data-number="21.3" class="anchored" data-anchor-id="splitting-by-biological-axis"><span class="header-section-number">21.3</span> Splitting by Biological Axis</h2>
<p>Beyond sequence homology, genomic data admits multiple axes along which splits can be constructed. The choice of axis determines what kind of generalization is being tested.</p>
<section id="splitting-by-individual" class="level3" data-number="21.3.1">
<h3 data-number="21.3.1" class="anchored" data-anchor-id="splitting-by-individual"><span class="header-section-number">21.3.1</span> Splitting by Individual</h3>
<p>For tasks involving human genetic variation, ensuring that data from the same individual (or related individuals) does not appear in both training and test sets is essential. A variant effect predictor trained on variants from person A and tested on other variants from person A may learn individual-specific patterns, such as haplotype structure or ancestry-correlated allele frequencies, that do not generalize to new individuals.</p>
<p>Family structure creates subtler leakage. First-degree relatives share approximately 50% of their genomes identical by descent. Even distant relatives share genomic segments that can be exploited by sufficiently powerful models. Best practice involves computing kinship coefficients across all individuals and either excluding one member of each related pair or assigning entire family clusters to the same split. The UK Biobank provides pre-computed relatedness estimates; other cohorts may require explicit calculation using tools like KING or PLINK.</p>
</section>
<section id="splitting-by-genomic-region" class="level3" data-number="21.3.2">
<h3 data-number="21.3.2" class="anchored" data-anchor-id="splitting-by-genomic-region"><span class="header-section-number">21.3.2</span> Splitting by Genomic Region</h3>
<p>Chromosome-based splits assign entire chromosomes to training or testing. This approach is common in regulatory genomics, where models trained on chromosomes 1-16 are tested on chromosomes 17-22 (or similar partitions). The advantage is simplicity and reproducibility; the disadvantage is that chromosomes are not independent. Chromosome 6 contains the HLA region with its unusual patterns of variation and selection; chromosome 21 is small and gene-poor; sex chromosomes have distinct biology. Results may vary substantially depending on which chromosomes are held out.</p>
<p>Region-based splits hold out contiguous segments (e.g., 1 Mb windows) distributed across the genome. This provides more uniform coverage than chromosome splits but requires careful attention to boundary effects. If a regulatory element spans the boundary between training and test regions, parts of its context may leak into training.</p>
</section>
<section id="splitting-by-gene-or-protein-family" class="level3" data-number="21.3.3">
<h3 data-number="21.3.3" class="anchored" data-anchor-id="splitting-by-gene-or-protein-family"><span class="header-section-number">21.3.3</span> Splitting by Gene or Protein Family</h3>
<p>For variant effect prediction, holding out entire genes or protein families tests whether models learn general principles versus gene-specific patterns. A model that achieves high accuracy by memorizing that TP53 variants are often pathogenic has not demonstrated understanding of mutational mechanisms. Gene-level splits force models to generalize to genes they have never seen, providing stronger evidence of biological insight.</p>
<p>Family-level splits extend this logic to groups of related genes. Holding out all kinases or all GPCRs tests whether models can generalize across evolutionary families. This is particularly stringent for protein structure and function prediction, where family membership strongly predicts properties.</p>
</section>
<section id="splitting-by-experimental-context" class="level3" data-number="21.3.4">
<h3 data-number="21.3.4" class="anchored" data-anchor-id="splitting-by-experimental-context"><span class="header-section-number">21.3.4</span> Splitting by Experimental Context</h3>
<p>Multi-task models that predict chromatin marks across cell types can be split by cell type rather than genomic position. Training on liver, lung, and brain while testing on heart and kidney assesses whether learned regulatory logic transfers across tissues. This matters because cell-type-specific factors drive much of regulatory variation; a model that has simply learned which regions are accessible in the training cell types may fail on novel cell types even when sequence features should transfer.</p>
<p>Similarly, models can be split by assay type (e.g., training on ATAC-seq, testing on DNase-seq), laboratory (to assess batch effects), or time point (for longitudinal data). Each split tests a different axis of generalization.</p>
</section>
<section id="splitting-by-ancestry" class="level3" data-number="21.3.5">
<h3 data-number="21.3.5" class="anchored" data-anchor-id="splitting-by-ancestry"><span class="header-section-number">21.3.5</span> Splitting by Ancestry</h3>
<p>For human genomic applications, ancestry-stratified evaluation has become essential. Models trained predominantly on European ancestry cohorts often show degraded performance in African, East Asian, South Asian, and admixed populations. This degradation reflects both differences in allele frequency spectra and differences in linkage disequilibrium patterns that affect which variants are informative.</p>
<p>Best practice reports performance separately for each major ancestry group represented in the data. When held-out ancestry groups are available (e.g., training on Europeans and testing on Africans), this provides the strongest test of cross-population generalization. When only European data are available, this limitation should be explicitly acknowledged, and claims about generalization should be appropriately modest. The confounding effects of ancestry on genomic predictions are detailed in <a href="p5-ch22-confounding.html" class="quarto-xref"><span>Chapter 22</span></a>.</p>
</section>
<section id="splitting-by-time" class="level3" data-number="21.3.6">
<h3 data-number="21.3.6" class="anchored" data-anchor-id="splitting-by-time"><span class="header-section-number">21.3.6</span> Splitting by Time</h3>
<p>Temporal splits assign data to training and test sets based on when observations were collected, annotations were created, or variants were classified. This strategy tests whether models generalize forward in time, the actual deployment scenario for any predictive system.</p>
<p>For variant pathogenicity prediction, temporal splits are particularly revealing. Training on ClinVar annotations from 2018 and testing on variants first classified in 2022 asks whether the model can predict labels that did not yet exist during training. This avoids the circularity that arises when training and test labels were assigned by similar processes at similar times. Variants classified more recently may reflect updated curation standards, new functional evidence, or reclassifications of previously uncertain variants; a model that performs well on these genuinely new classifications demonstrates predictive validity rather than recapitulation of historical curation patterns.</p>
<p>Implementing temporal splits requires metadata that many datasets lack. ClinVar provides submission dates, enabling clean temporal partitioning. UniProt tracks annotation dates for functional assignments. Clinical cohorts with longitudinal follow-up naturally admit temporal splits based on diagnosis dates. When temporal metadata is unavailable, publication dates of source literature can serve as proxies, though these may not perfectly reflect when information became available to model developers.</p>
<p>The key limitation of temporal splits is non-stationarity. The distribution of variants classified in 2022 may differ systematically from those classified in 2018, not because biology changed but because research priorities, sequencing technologies, and ascertainment patterns evolved. Performance degradation on temporally held-out data may reflect distribution shift rather than genuine failure to generalize. Combining temporal splits with stratified analysis (performance by variant type, gene category, or evidence strength) helps disentangle these factors.</p>
</section>
</section>
<section id="leakage-taxonomy-and-detection" class="level2" data-number="21.4">
<h2 data-number="21.4" class="anchored" data-anchor-id="leakage-taxonomy-and-detection"><span class="header-section-number">21.4</span> Leakage Taxonomy and Detection</h2>
<p>Even with careful splitting, leakage can enter evaluations through multiple pathways. Understanding common leakage patterns helps practitioners design cleaner evaluations and critically assess published results.</p>
<section id="feature-leakage" class="level3" data-number="21.4.1">
<h3 data-number="21.4.1" class="anchored" data-anchor-id="feature-leakage"><span class="header-section-number">21.4.1</span> Feature Leakage</h3>
<p>Feature leakage occurs when input features encode information about the target that would not be available at prediction time. In genomics, conservation scores are a common source. If a model uses PhyloP scores as features and the target is pathogenicity, the model may learn that “conserved positions are more likely pathogenic” without learning anything about variant biology. This would be fine if conservation scores are intended to be part of the prediction pipeline, but problematic if the goal is to develop a model that can predict pathogenicity from sequence alone.</p>
<p>Similarly, population allele frequency encodes selection pressure. A model that learns “rare variants are more likely pathogenic” has discovered a useful heuristic but not necessarily a mechanistic understanding. Whether this counts as leakage depends on the intended use case. For clinical variant interpretation where allele frequency is always available, exploiting this feature is appropriate. For understanding variant biology, it may mask whether the model has learned anything beyond allele frequency.</p>
</section>
<section id="label-leakage" class="level3" data-number="21.4.2">
<h3 data-number="21.4.2" class="anchored" data-anchor-id="label-leakage"><span class="header-section-number">21.4.2</span> Label Leakage</h3>
<p>Label leakage occurs when target labels are derived from information that the model can access through its features. The classic example is training pathogenicity predictors on ClinVar annotations while using sequence features that were used to construct ClinVar annotations. If ClinVar curators used SIFT and PolyPhen scores when classifying variants, and the model uses similar sequence features, high performance may reflect recapitulation of curation criteria rather than independent predictive power.</p>
<p>Temporal label leakage is subtler. A model trained on ClinVar annotations from 2020 and tested on annotations from 2023 may perform well because new annotations were informed by model-like predictions. The apparent validation is circular: the model predicts labels that were partially derived from model-like reasoning.</p>
</section>
<section id="benchmark-leakage" class="level3" data-number="21.4.3">
<h3 data-number="21.4.3" class="anchored" data-anchor-id="benchmark-leakage"><span class="header-section-number">21.4.3</span> Benchmark Leakage</h3>
<p>Benchmark leakage occurs when test set construction was influenced by methods similar to those being evaluated. If a protein function benchmark was created by selecting proteins with high-confidence annotations, and those annotations were partly derived from sequence similarity searches, sequence-based models may perform well by exploiting the same similarity that guided benchmark construction.</p>
<p>Foundation models face particular challenges with benchmark leakage. If a DNA language model is pretrained on all publicly available genomic sequence including ENCODE data, and then evaluated on ENCODE-derived benchmarks, the pretraining has exposed the model to information about the test distribution even if specific test examples were held out. The model may have learned statistical patterns in ENCODE data that transfer to ENCODE benchmarks without reflecting genuine biological understanding.</p>
</section>
<section id="detection-strategies" class="level3" data-number="21.4.4">
<h3 data-number="21.4.4" class="anchored" data-anchor-id="detection-strategies"><span class="header-section-number">21.4.4</span> Detection Strategies</h3>
<p>Several strategies help detect leakage. <strong>Baseline analysis</strong> asks whether simple models that could not plausibly have learned biology achieve suspiciously high performance. If a linear model using only allele frequency achieves 0.80 AUROC on a pathogenicity benchmark, and a sophisticated deep model achieves 0.82, the marginal improvement may not justify claims of biological insight.</p>
<p><strong>Feature ablation</strong> systematically removes potentially leaky features and measures performance degradation. If removing conservation scores causes a 20-point drop in AUROC, the model was heavily dependent on conservation rather than learning independent predictors.</p>
<p><strong>Confounder analysis</strong> explicitly models potential confounders and tests whether model predictions remain informative after conditioning. If a variant effect predictor’s scores become non-predictive after controlling for gene length and expression level, the model may have learned gene-level confounders rather than variant-level effects.</p>
<p><strong>Temporal validation</strong> evaluates models on data collected after the training data was frozen. If performance degrades substantially on newer data, the model may have been fitted to temporal artifacts in the original dataset.</p>
</section>
</section>
<section id="metrics-for-genomic-tasks" class="level2" data-number="21.5">
<h2 data-number="21.5" class="anchored" data-anchor-id="metrics-for-genomic-tasks"><span class="header-section-number">21.5</span> Metrics for Genomic Tasks</h2>
<p>Metrics quantify model performance but different metrics answer different questions. Choosing appropriate metrics requires clarity about what aspect of performance matters for the intended application.</p>
<section id="discrimination-metrics" class="level3" data-number="21.5.1">
<h3 data-number="21.5.1" class="anchored" data-anchor-id="discrimination-metrics"><span class="header-section-number">21.5.1</span> Discrimination Metrics</h3>
<p>For binary outcomes (pathogenic versus benign, bound versus unbound, accessible versus closed), discrimination metrics assess how well the model separates classes. The <strong>area under the receiver operating characteristic curve (AUROC)</strong> measures the probability that a randomly selected positive example is ranked above a randomly selected negative example. AUROC is threshold-independent and widely reported but can be misleading when classes are highly imbalanced.</p>
<p>The <strong>area under the precision-recall curve (AUPRC)</strong> better reflects performance when positives are rare. For variant pathogenicity prediction, where perhaps 1% of variants are truly pathogenic, a model achieving 0.95 AUROC might still have poor precision at useful recall levels. AUPRC directly captures the precision-recall trade-off that matters for applications requiring both high sensitivity and manageable false positive rates.</p>
<p><strong>Sensitivity</strong>, <strong>specificity</strong>, <strong>positive predictive value</strong>, and <strong>negative predictive value</strong> require specifying a decision threshold. These metrics are more interpretable for specific use cases (e.g., “the model identifies 90% of pathogenic variants while flagging only 5% of benign variants as false positives”) but require choosing thresholds that may not generalize across settings.</p>
</section>
<section id="regression-and-correlation-metrics" class="level3" data-number="21.5.2">
<h3 data-number="21.5.2" class="anchored" data-anchor-id="regression-and-correlation-metrics"><span class="header-section-number">21.5.2</span> Regression and Correlation Metrics</h3>
<p>For continuous predictions (expression levels, effect sizes, binding affinities), correlation metrics assess agreement between predicted and observed values. <strong>Pearson correlation</strong> measures linear association; <strong>Spearman correlation</strong> measures rank association and is robust to nonlinear relationships. The <strong>coefficient of determination (R²)</strong> measures variance explained, though interpretation requires care when baseline performance is near zero.</p>
<p>For predictions at genomic scale (e.g., predicted versus observed expression across thousands of genes), these metrics may obscure important patterns. A model might achieve high genome-wide correlation by correctly predicting which genes are highly expressed while failing on the genes where predictions matter most. Task-specific stratification, such as correlation within expression quantiles or among disease-relevant genes, provides more actionable information.</p>
</section>
<section id="ranking-and-prioritization-metrics" class="level3" data-number="21.5.3">
<h3 data-number="21.5.3" class="anchored" data-anchor-id="ranking-and-prioritization-metrics"><span class="header-section-number">21.5.3</span> Ranking and Prioritization Metrics</h3>
<p>Many genomic workflows care about ranking rather than absolute prediction. Variant prioritization pipelines rank candidates for follow-up; gene prioritization ranks targets for experimental validation. <strong>Top-k recall</strong> measures the fraction of true positives captured in the top k predictions. <strong>Enrichment at k</strong> compares the true positive rate in the top k to the background rate. <strong>Normalized discounted cumulative gain (NDCG)</strong> weights ranking quality by position, penalizing relevant items placed lower in the list more than those placed near the top.</p>
<p>These metrics align with how predictions are actually used. If experimental capacity permits validating only 20 variants per locus, top-20 recall matters more than global AUROC. Reporting both global metrics and rank-aware metrics at relevant cutoffs provides a complete picture.</p>
</section>
<section id="calibration-metrics" class="level3" data-number="21.5.4">
<h3 data-number="21.5.4" class="anchored" data-anchor-id="calibration-metrics"><span class="header-section-number">21.5.4</span> Calibration Metrics</h3>
<p>Calibration assesses whether predicted probabilities match observed frequencies. A well-calibrated model that predicts 0.8 probability of pathogenicity should be correct about 80% of the time across all variants receiving that score. <strong>Reliability diagrams</strong> plot predicted probabilities against observed frequencies within binned intervals, with deviations from the diagonal indicating miscalibration. <strong>Expected calibration error (ECE)</strong> summarizes miscalibration as the weighted average absolute deviation across bins.</p>
<p>Calibration matters whenever predictions inform decisions. A miscalibrated model that reports 0.95 probability when the true probability is 0.60 will lead to inappropriate confidence in uncertain predictions. Even models with excellent discrimination can be poorly calibrated, requiring post-hoc calibration methods such as Platt scaling or isotonic regression. <a href="p5-ch23-uncertainty.html" class="quarto-xref"><span>Chapter 23</span></a> addresses calibration and uncertainty quantification in greater depth.</p>
</section>
<section id="clinical-utility-metrics" class="level3" data-number="21.5.5">
<h3 data-number="21.5.5" class="anchored" data-anchor-id="clinical-utility-metrics"><span class="header-section-number">21.5.5</span> Clinical Utility Metrics</h3>
<p>For clinical applications, discrimination and calibration are necessary but not sufficient. <strong>Decision curves</strong> plot net benefit across decision thresholds, where net benefit weighs the value of true positives against the cost of false positives at each threshold. A model may achieve high AUROC but offer no net benefit at clinically relevant thresholds if it fails to discriminate in the region where decisions are actually made.</p>
<p><strong>Net reclassification improvement (NRI)</strong> measures how often adding genomic features to a clinical model changes risk classifications in the correct direction. This directly addresses whether genomics adds clinical value beyond existing predictors. <a href="p6-ch25-clinical-risk.html" class="quarto-xref"><span>Chapter 25</span></a> provides detailed treatment of clinical evaluation frameworks.</p>
</section>
</section>
<section id="baseline-selection" class="level2" data-number="21.6">
<h2 data-number="21.6" class="anchored" data-anchor-id="baseline-selection"><span class="header-section-number">21.6</span> Baseline Selection</h2>
<p>Baseline comparisons determine the meaning of reported performance. A model achieving 0.85 AUROC might represent a major advance if the best prior method achieved 0.70, or a trivial improvement if simple heuristics achieve 0.83. Choosing appropriate baselines is as important as choosing appropriate metrics.</p>
<section id="strong-baselines-not-straw-men" class="level3" data-number="21.6.1">
<h3 data-number="21.6.1" class="anchored" data-anchor-id="strong-baselines-not-straw-men"><span class="header-section-number">21.6.1</span> Strong Baselines, Not Straw Men</h3>
<p>The temptation to compare against weak baselines inflates apparent contributions. A deep learning model compared against a naive prior or a deliberately crippled baseline will appear impressive regardless of whether it offers genuine value. Strong baselines force honest assessment of improvement.</p>
<p>For sequence-based predictions, position weight matrices (PWMs) and k-mer logistic regression provide classical baselines that capture sequence composition without deep learning. If a convolutional model barely outperforms logistic regression on k-mer counts, the convolutional architecture may not be contributing as much as claimed.</p>
<p>For variant effect prediction, simple features like allele frequency, conservation scores, and amino acid properties provide baselines that any sophisticated model should substantially exceed. CADD (<a href="p1-ch04-vep-classical.html" class="quarto-xref"><span>Chapter 4</span></a>) serves as a well-calibrated baseline that combines many hand-crafted features; outperforming CADD demonstrates that learning provides value beyond feature engineering.</p>
<p>For foundation models, comparisons should include both randomly initialized models of similar architecture (to isolate the value of pretraining) and simpler pretrained models (to isolate the value of scale or architectural innovations). Claiming that pretraining helps requires demonstrating improvement over training from scratch on the same downstream data.</p>
</section>
<section id="historical-baselines-and-progress-tracking" class="level3" data-number="21.6.2">
<h3 data-number="21.6.2" class="anchored" data-anchor-id="historical-baselines-and-progress-tracking"><span class="header-section-number">21.6.2</span> Historical Baselines and Progress Tracking</h3>
<p>Comparing to methods from five years ago may demonstrate progress but overstates the contribution of any single method. Comparisons should include the best currently available alternatives, not just historically important ones. When prior work is not directly comparable (different data, different splits, different metrics), reimplementing baselines on common benchmarks provides fairer comparison.</p>
<p>Field-wide progress tracking benefits from persistent benchmarks with frozen test sets. Once test set results for a benchmark are published, that benchmark becomes less useful for future model development because the test set is no longer truly held out. Periodic benchmark refresh with new held-out data helps maintain evaluation integrity.</p>
</section>
<section id="non-deep-learning-baselines" class="level3" data-number="21.6.3">
<h3 data-number="21.6.3" class="anchored" data-anchor-id="non-deep-learning-baselines"><span class="header-section-number">21.6.3</span> Non-Deep-Learning Baselines</h3>
<p>Deep learning models should be compared against strong non-deep alternatives. Gradient-boosted trees, random forests, and regularized linear models often achieve competitive performance with far less computation. If a 100-million-parameter transformer barely outperforms XGBoost on tabular features, the complexity may not be justified.</p>
<p>This comparison is especially important for clinical deployment, where simpler models may be preferred for interpretability, computational efficiency, or regulatory approval. Demonstrating that deep learning provides substantial gains over strong non-deep baselines strengthens the case for adoption.</p>
</section>
</section>
<section id="ablation-studies" class="level2" data-number="21.7">
<h2 data-number="21.7" class="anchored" data-anchor-id="ablation-studies"><span class="header-section-number">21.7</span> Ablation Studies</h2>
<p>Ablation studies systematically remove or modify model components to understand their contributions. Where baselines compare across methods, ablations investigate within a method, revealing which design choices actually matter.</p>
<section id="component-isolation" class="level3" data-number="21.7.1">
<h3 data-number="21.7.1" class="anchored" data-anchor-id="component-isolation"><span class="header-section-number">21.7.1</span> Component Isolation</h3>
<p>Standard ablations remove individual components: attention layers, skip connections, normalization schemes, specific input features. If removing attention heads causes minimal performance degradation, the model may not be exploiting long-range dependencies as claimed. If removing a particular input modality has no effect, that modality may not be contributing useful information.</p>
<p>Ablations should be designed to test specific hypotheses. If the claim is that a foundation model learns biologically meaningful representations, ablating pretraining (comparing to random initialization) directly tests this claim. If the claim is that cross-attention between modalities enables integration, ablating cross-attention while retaining separate encoders tests whether integration provides value.</p>
</section>
<section id="hyperparameter-sensitivity" class="level3" data-number="21.7.2">
<h3 data-number="21.7.2" class="anchored" data-anchor-id="hyperparameter-sensitivity"><span class="header-section-number">21.7.2</span> Hyperparameter Sensitivity</h3>
<p>Reporting performance across hyperparameter ranges reveals robustness. A model that achieves state-of-the-art performance only at a narrow learning rate range with specific regularization may be overfit to the evaluation setup. Consistent performance across reasonable hyperparameter variations provides stronger evidence of genuine capability.</p>
</section>
<section id="architecture-search-confounds" class="level3" data-number="21.7.3">
<h3 data-number="21.7.3" class="anchored" data-anchor-id="architecture-search-confounds"><span class="header-section-number">21.7.3</span> Architecture Search Confounds</h3>
<p>When model development involves extensive architecture search, reported performance conflates the value of the final architecture with the value of search on the validation set. The validation set is no longer truly held out; it has been used to select among architectures. Final evaluation on a completely untouched test set, with the architecture fixed before test set examination, provides cleaner assessment.</p>
</section>
<section id="reporting-standards" class="level3" data-number="21.7.4">
<h3 data-number="21.7.4" class="anchored" data-anchor-id="reporting-standards"><span class="header-section-number">21.7.4</span> Reporting Standards</h3>
<p>Ablation tables should clearly indicate what was changed in each condition, the number of random seeds or runs, and measures of variance. Single-run ablations can produce misleading results due to training stochasticity. Reporting means and standard deviations across multiple runs reveals whether observed differences exceed random variation.</p>
</section>
</section>
<section id="statistical-rigor" class="level2" data-number="21.8">
<h2 data-number="21.8" class="anchored" data-anchor-id="statistical-rigor"><span class="header-section-number">21.8</span> Statistical Rigor</h2>
<p>Performance differences between models may reflect genuine capability differences or random variation in training and evaluation. Statistical analysis distinguishes signal from noise.</p>
<section id="significance-testing" class="level3" data-number="21.8.1">
<h3 data-number="21.8.1" class="anchored" data-anchor-id="significance-testing"><span class="header-section-number">21.8.1</span> Significance Testing</h3>
<p>For classification metrics, significance tests ask whether observed differences exceed what would be expected from sampling variation. <strong>Bootstrap confidence intervals</strong> resample the test set with replacement, recompute metrics on each resample, and report the distribution of metric values. Non-overlapping 95% confidence intervals suggest significant differences. <strong>Permutation tests</strong> shuffle predictions between models and measure how often shuffled differences exceed observed differences.</p>
<p>For comparing multiple models across multiple benchmarks, correction for multiple testing becomes important. Without correction, 20 pairwise comparisons will produce an expected one false positive at the 0.05 level even when all models perform equally. The <strong>Bonferroni correction</strong> divides the significance threshold by the number of tests; the <strong>Benjamini-Hochberg procedure</strong> controls false discovery rate with more power than Bonferroni.</p>
</section>
<section id="effect-sizes" class="level3" data-number="21.8.2">
<h3 data-number="21.8.2" class="anchored" data-anchor-id="effect-sizes"><span class="header-section-number">21.8.2</span> Effect Sizes</h3>
<p>Statistical significance does not imply practical significance. A difference of 0.001 AUROC might be statistically significant with millions of test examples while being practically meaningless. <strong>Effect sizes</strong> quantify the magnitude of differences independent of sample size. Cohen’s d for continuous outcomes and odds ratios for binary outcomes provide standardized measures of effect magnitude.</p>
<p>Reporting both significance tests and effect sizes provides complete information. A result that is statistically significant with a tiny effect size warrants different interpretation than one that is significant with a large effect size.</p>
</section>
<section id="confidence-intervals-on-metrics" class="level3" data-number="21.8.3">
<h3 data-number="21.8.3" class="anchored" data-anchor-id="confidence-intervals-on-metrics"><span class="header-section-number">21.8.3</span> Confidence Intervals on Metrics</h3>
<p>Point estimates of AUROC or correlation should be accompanied by confidence intervals. <strong>DeLong’s method</strong> provides analytical confidence intervals for AUROC; <strong>bootstrap methods</strong> provide distribution-free intervals for any metric. Reporting “AUROC = 0.85 (95% CI: 0.82-0.88)” is more informative than “AUROC = 0.85” alone.</p>
</section>
<section id="variance-across-random-seeds" class="level3" data-number="21.8.4">
<h3 data-number="21.8.4" class="anchored" data-anchor-id="variance-across-random-seeds"><span class="header-section-number">21.8.4</span> Variance Across Random Seeds</h3>
<p>Deep learning models are sensitive to initialization and optimization stochasticity. Training the same architecture with different random seeds can produce substantially different results. Best practice trains multiple runs and reports means and standard deviations. If the standard deviation across runs exceeds the difference between methods, claimed improvements may not be reproducible.</p>
</section>
</section>
<section id="evaluating-foundation-models" class="level2" data-number="21.9">
<h2 data-number="21.9" class="anchored" data-anchor-id="evaluating-foundation-models"><span class="header-section-number">21.9</span> Evaluating Foundation Models</h2>
<p>Genomic foundation models (<a href="p3-ch10-fm-principles.html" class="quarto-xref"><span>Chapter 10</span></a>) admit multiple evaluation paradigms, each testing different aspects of learned representations.</p>
<section id="zero-shot-evaluation" class="level3" data-number="21.9.1">
<h3 data-number="21.9.1" class="anchored" data-anchor-id="zero-shot-evaluation"><span class="header-section-number">21.9.1</span> Zero-Shot Evaluation</h3>
<p>In zero-shot evaluation, the pretrained model is applied without any task-specific training. For masked language models, this typically means using token probabilities to score variants or classify sequences. A variant that disrupts a position the model predicts with high confidence may indicate functional importance.</p>
<p>Zero-shot performance tests whether pretraining captures task-relevant structure without explicit supervision. Strong zero-shot performance suggests the pretraining objective aligned with the evaluation task; weak zero-shot performance suggests misalignment. Comparing zero-shot performance to simple baselines (e.g., conservation scores for variant effects) calibrates whether the foundation model provides value beyond what simpler approaches achieve.</p>
</section>
<section id="linear-probing" class="level3" data-number="21.9.2">
<h3 data-number="21.9.2" class="anchored" data-anchor-id="linear-probing"><span class="header-section-number">21.9.2</span> Linear Probing</h3>
<p>Linear probing freezes the foundation model and trains only a linear classifier on extracted embeddings. This isolates representation quality from fine-tuning capacity. If a linear probe on foundation model embeddings substantially outperforms a linear probe on random embeddings, the foundation model has learned useful features.</p>
<p>Layer-wise probing reveals where information is encoded. Early layers may capture local sequence features while later layers capture more abstract patterns. If the information needed for a task is extractable from early layers, the model may not require the full depth of the architecture for that application.</p>
</section>
<section id="fine-tuning-evaluation" class="level3" data-number="21.9.3">
<h3 data-number="21.9.3" class="anchored" data-anchor-id="fine-tuning-evaluation"><span class="header-section-number">21.9.3</span> Fine-Tuning Evaluation</h3>
<p>Full fine-tuning adapts all model parameters to the downstream task. This provides the best performance but conflates representation quality with adaptation capacity. A foundation model might achieve high fine-tuned performance through the capacity of its architecture rather than the quality of its pretrained representations.</p>
<p>Comparing fine-tuned foundation models to equivalently architected models trained from scratch isolates the value of pretraining. If both approaches converge to similar performance given sufficient downstream data, pretraining provides label efficiency (less data needed to reach a given performance level) rather than improved final performance. Data efficiency curves, plotting performance against downstream training set size, reveal this trade-off.</p>
</section>
<section id="transfer-across-tasks" class="level3" data-number="21.9.4">
<h3 data-number="21.9.4" class="anchored" data-anchor-id="transfer-across-tasks"><span class="header-section-number">21.9.4</span> Transfer Across Tasks</h3>
<p>Foundation models justify their “foundation” designation by transferring to diverse downstream tasks. Evaluating on a single task, however well-designed, cannot assess breadth of transfer. Multi-task evaluation across regulatory prediction, variant effects, protein properties, and other applications reveals whether foundation models provide general-purpose representations or excel only on tasks similar to their pretraining objective.</p>
<p>Transfer across species, tissues, and experimental modalities provides additional evidence of generalization. A DNA language model that transfers from human to mouse, or from blood cells to neurons, demonstrates that its representations capture biological principles rather than species-specific or tissue-specific patterns.</p>
</section>
</section>
<section id="calibration-essentials" class="level2" data-number="21.10">
<h2 data-number="21.10" class="anchored" data-anchor-id="calibration-essentials"><span class="header-section-number">21.10</span> Calibration Essentials</h2>
<p>Even models with strong discrimination may produce probability estimates that mislead decisions. Calibration assesses whether predicted probabilities match observed frequencies, a property essential for rational decision-making.</p>
<section id="assessing-calibration" class="level3" data-number="21.10.1">
<h3 data-number="21.10.1" class="anchored" data-anchor-id="assessing-calibration"><span class="header-section-number">21.10.1</span> Assessing Calibration</h3>
<p><strong>Reliability diagrams</strong> bin predictions by predicted probability and plot the mean predicted probability against the observed frequency within each bin. Perfect calibration produces points along the diagonal; deviations reveal systematic over-confidence (points below the diagonal) or under-confidence (points above).</p>
<p><strong>Expected calibration error</strong> summarizes miscalibration as a single number: the weighted average absolute difference between predicted and observed probabilities across bins. Lower ECE indicates better calibration. However, ECE is sensitive to binning choices and should be reported alongside reliability diagrams for interpretability.</p>
<p><strong>Calibration by subgroup</strong> reveals whether miscalibration varies across populations or conditions. A model might be well-calibrated overall but systematically overconfident for rare variant classes or underrepresented ancestries. Stratified calibration analysis identifies these disparities.</p>
</section>
<section id="recalibration-methods" class="level3" data-number="21.10.2">
<h3 data-number="21.10.2" class="anchored" data-anchor-id="recalibration-methods"><span class="header-section-number">21.10.2</span> Recalibration Methods</h3>
<p>Post-hoc recalibration adjusts predicted probabilities to improve calibration without retraining the model. <strong>Temperature scaling</strong> divides logits by a learned temperature parameter before applying softmax, compressing or expanding the probability distribution. <strong>Platt scaling</strong> fits a logistic regression from model outputs to true labels. <strong>Isotonic regression</strong> fits a monotonic function that maps model outputs to calibrated probabilities.</p>
<p>These methods require held-out calibration data distinct from training and test sets. Calibrating on test data and then evaluating calibration on the same test data produces overoptimistic estimates.</p>
<p>For detailed treatment of calibration and uncertainty quantification, including epistemic versus aleatoric uncertainty and selective prediction, see <a href="p5-ch23-uncertainty.html" class="quarto-xref"><span>Chapter 23</span></a>.</p>
</section>
</section>
<section id="putting-it-all-together" class="level2" data-number="21.11">
<h2 data-number="21.11" class="anchored" data-anchor-id="putting-it-all-together"><span class="header-section-number">21.11</span> Putting It All Together</h2>
<p>When designing or evaluating a genomic model assessment, working through a systematic checklist helps identify gaps and potential problems.</p>
<p><strong>Level of decision</strong>: Is the model intended for molecular prediction, variant prioritization, patient risk stratification, or clinical action? Metrics should align with the actual decision context. Enrichment metrics suit variant ranking; net benefit matters for clinical decisions.</p>
<p><strong>Data splits</strong>: Are individuals, genomic regions, gene families, and ancestries appropriately separated? Has homology-aware clustering been applied with appropriate identity thresholds? Is there any plausible pathway for leakage or circularity?</p>
<p><strong>Baselines</strong>: Are comparisons made against the best available alternatives, not just historical or deliberately weak baselines? Do non-deep-learning baselines establish floors? Does the improvement over baselines justify the complexity?</p>
<p><strong>Metrics</strong>: Are multiple metrics reported to capture discrimination, calibration, and ranking quality? Are metrics computed with confidence intervals? Are subgroup-stratified metrics reported for fairness assessment?</p>
<p><strong>Ablations</strong>: Have component contributions been isolated through systematic ablation? Is performance robust across hyperparameter ranges and random seeds?</p>
<p><strong>Statistical rigor</strong>: Are significance tests applied with multiple testing correction? Are effect sizes reported alongside p-values? Are confidence intervals provided for key metrics?</p>
<p><strong>Foundation model specifics</strong>: For foundation models, is performance reported across zero-shot, probing, and fine-tuning regimes? Do data efficiency curves reveal where pretraining value lies? Has transfer been tested across diverse tasks?</p>
<p><strong>Robustness</strong>: How does performance vary across cohorts, platforms, and ancestries? How does the model behave under distribution shift, missing data, or label noise?</p>
<p>This checklist is not exhaustive but covers the most common evaluation pitfalls. Working through it systematically at the design stage can prevent problems that are difficult to fix retrospectively. Reviewers and readers can use the same checklist to critically assess published work.</p>
</section>
<section id="looking-forward" class="level2" data-number="21.12">
<h2 data-number="21.12" class="anchored" data-anchor-id="looking-forward"><span class="header-section-number">21.12</span> Looking Forward</h2>
<p>Rigorous evaluation requires sustained effort at every stage, from data splitting through statistical analysis. The shortcuts that accelerate research in other domains, random splits, single-metric comparisons, significance tests without effect sizes, produce misleading conclusions when applied to genomic data. Homology, population structure, batch effects, and label circularity create countless opportunities for self-deception.</p>
<p>The chapters that follow address complementary aspects of reliability. <a href="p5-ch22-confounding.html" class="quarto-xref"><span>Chapter 22</span></a> examines how confounders, biases, and data artifacts can produce evaluation results that evaporate under deployment. Population stratification, batch effects, and benchmark leakage can all create illusions of performance that careful evaluation might fail to detect. <a href="p5-ch23-uncertainty.html" class="quarto-xref"><span>Chapter 23</span></a> develops the theory and practice of uncertainty quantification, extending the calibration discussion here to cover epistemic versus aleatoric uncertainty, selective prediction, and communication of model confidence. <a href="p5-ch24-interpretability.html" class="quarto-xref"><span>Chapter 24</span></a> addresses the complementary question of not just whether models work but why they work, developing tools to distinguish genuine biological insight from pattern matching on confounded data.</p>
<p>Together with the benchmark survey in <a href="p5-ch20-benchmarks.html" class="quarto-xref"><span>Chapter 20</span></a>, these chapters provide the critical apparatus for engaging with genomic model claims. <a href="p5-ch22-confounding.html" class="quarto-xref"><span>Chapter 22</span></a> examines how population stratification, batch effects, and ascertainment bias can produce results that evaporate under deployment. <a href="p5-ch23-uncertainty.html" class="quarto-xref"><span>Chapter 23</span></a> extends calibration to epistemic versus aleatoric uncertainty and selective prediction. <a href="p5-ch24-interpretability.html" class="quarto-xref"><span>Chapter 24</span></a> addresses whether models have learned biology or exploited confounded patterns. For clinical applications specifically, <a href="p6-ch25-clinical-risk.html" class="quarto-xref"><span>Chapter 25</span></a> develops evaluation frameworks tailored to risk prediction, where net benefit and decision curves supplement standard discrimination metrics. The question is never simply “what is the AUROC?” but rather “what has been demonstrated, and how much should we trust it?” The answer depends on the details.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./p5-ch20-benchmarks.html" class="pagination-link" aria-label="Benchmarks">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Benchmarks</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./p5-ch22-confounding.html" class="pagination-link" aria-label="Confounders and Leakage">
        <span class="nav-page-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Confounders and Leakage</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Copyright 2025, Josh Meehl</p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>