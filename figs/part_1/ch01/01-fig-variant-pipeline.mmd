%%{init: {'theme': 'base', 'themeVariables': {
    'primaryColor': '#1f77b4',
    'primaryTextColor': '#ffffff',
    'primaryBorderColor': '#1f77b4',
    'lineColor': '#7f7f7f',
    'secondaryColor': '#aec7e8',
    'tertiaryColor': '#f0f0f0',
    'fontFamily': 'Arial, sans-serif'
}}}%%
flowchart TD
    subgraph Input["<b>Sample Preparation</b>"]
        DNA["DNA Sample<br/><i>~3 billion bp</i>"]
        FRAG["Fragment &<br/>Library Prep"]
    end

    subgraph SEQ["<b>Sequencing</b>"]
        direction LR
        SHORT["Short-Read<br/>(Illumina)<br/><i>100-300 bp reads</i>"]
        LONG["Long-Read<br/>(PacBio/ONT)<br/><i>10 kb - 1 Mb reads</i>"]
    end

    subgraph BASECALL["<b>Base Calling</b>"]
        FASTQ["FASTQ Files<br/><i>~100 GB</i>"]
    end

    subgraph ALIGN["<b>Alignment</b>"]
        REF["Reference Genome<br/>(GRCh38 / T2T-CHM13)"]
        MAPPER["BWA-MEM / minimap2"]
        BAM["BAM/CRAM<br/><i>~30-60 GB</i>"]
    end

    subgraph POSTPROC["<b>Post-Processing</b>"]
        DUPMARK["Mark<br/>Duplicates"]
        BQSR["Base Quality<br/>Recalibration"]
    end

    subgraph CALL["<b>Variant Calling</b>"]
        CALLER["Per-sample Calling<br/>(HaplotypeCaller /<br/>DeepVariant)"]
        GVCF["gVCF<br/><i>per sample</i>"]
    end

    subgraph JOINT["<b>Cohort Processing</b>"]
        JOINTCALL["Joint Genotyping<br/>(GLnexus)"]
        FILTER["Filtering<br/>(VQSR)"]
    end

    subgraph Output["<b>Final Output</b>"]
        VCF["Multi-sample VCF<br/><i>~1-5 GB</i>"]
    end

    DNA --> FRAG
    FRAG --> SHORT
    FRAG --> LONG
    SHORT --> FASTQ
    LONG --> FASTQ
    FASTQ --> MAPPER
    REF --> MAPPER
    MAPPER --> BAM
    BAM --> DUPMARK
    DUPMARK --> BQSR
    BQSR --> CALLER
    CALLER --> GVCF
    GVCF --> JOINTCALL
    JOINTCALL --> FILTER
    FILTER --> VCF

    style DNA fill:#1f77b4,stroke:#1f77b4,color:#fff
    style VCF fill:#2ca02c,stroke:#2ca02c,color:#fff
    style SHORT fill:#aec7e8,stroke:#1f77b4
    style LONG fill:#98df8a,stroke:#2ca02c
    style CALLER fill:#9467bd,stroke:#9467bd,color:#fff
    style JOINTCALL fill:#9467bd,stroke:#9467bd,color:#fff
